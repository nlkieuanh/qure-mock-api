var API_ADS_ANGLES; function advToISODate(e) { return e instanceof Date ? e.getFullYear() + `-${String(e.getMonth() + 1).padStart(2, "0")}-` + String(e.getDate()).padStart(2, "0") : "" } function correctionCompareRange(e, a, t) { a = a.getTime() - e.getTime(); return new Date(t.getTime() + a) } function advHexToRgba(e, a) { return !e || "#" !== e[0] || e.length < 7 ? `rgba(0,0,0,${a})` : `rgba(${parseInt(e.slice(1, 3), 16)},${parseInt(e.slice(3, 5), 16)},${parseInt(e.slice(5, 7), 16)},${a})` } function advSumSubset(t, e) { return Array.isArray(t) ? e?.length ? e.reduce((e, a) => e + (Number(t[a]) || 0), 0) : t.reduce((e, a) => e + (Number(a) || 0), 0) : 0 } void 0 === API_ADS_ANGLES && (API_ADS_ANGLES = ("undefined" != typeof API_BASE_URL ? API_BASE_URL : "") + "api/advertising/advertising-angles"); let ADV_MAIN_COLOR = "#3366cc", ADV_COMPARE_COLOR = "#fcc500"; function advIsAnglesDataEmpty(e) { if (e && e.yourCompany) { let a = e.yourCompany.anglesOffers || {}; var t = Object.keys(a); if (0 < t.length && t.some(e => { e = a[e]; return 0 !== e && null != e && "" !== e })) return !1; if (e.competitors && Array.isArray(e.competitors)) for (var r of e.competitors) { let a = r.anglesOffers || {}; r = Object.keys(a); if (0 < r.length && r.some(e => { e = a[e]; return 0 !== e && null != e && "" !== e })) return !1 } } return !0 } function advIsChartPayloadEmpty(e) { if (e) { e = [e.yourCompany, ...e.competitors || []]; if (0 !== e.length) for (var a of e) if (a && a.values && Array.isArray(a.values)) if (a.values.some(e => { return null != e && "" !== e && (e = Number(e), !isNaN(e)) && 0 !== e })) return !1 } return !0 } function advClearTable(e) { var a; e && (e = (e = e.closest(".tab-content-flex")) ? e.querySelector(".table-render") : null) && (a = (e.querySelector(".adv-channel-table-wrapper") || e).querySelector(".adv-channel-table")) && (a.innerHTML = "", e._advRebuildTable) && delete e._advRebuildTable } function advIsTransformedDataEmpty(e) { if (e) { var a, e = e.channels || []; if (0 !== e.length) for (var t of e) for (a of t.companies || []) for (var r in a) if (Array.isArray(a[r])) if (a[r].some(e => { e = Number(e); return !isNaN(e) && 0 !== e })) return !1 } return !0 } function advFilterDataByPlatform(e, t) { var a, r; return e && t && "all" !== t ? ((a = JSON.parse(JSON.stringify(e)))._advState || (a._advState = {}), a._advState.platform = t, a.yourCompany && (a.yourCompany.platforms && (r = a.yourCompany.platforms[t] || {}, a.yourCompany.anglesOffers = r), a.yourCompany.platformsMetrics) && a.yourCompany.platformsMetrics[t] && (a.yourCompany.anglesOffersMetrics = a.yourCompany.platformsMetrics[t]), a.competitors && Array.isArray(a.competitors) && a.competitors.forEach(e => { var a; e.platforms && (a = e.platforms[t] || {}, e.anglesOffers = a), e.platformsMetrics && e.platformsMetrics[t] && (e.anglesOffersMetrics = e.platformsMetrics[t]) }), a) : (e && !e._advState && (e._advState = {}), e && e._advState && (e._advState.platform = "all"), e) } function advBuildApiUrl(e, a) { if (!a || void 0 === a.mode) return console.error("[ADV] advBuildApiUrl: mode is required"), ""; let t = API_ADS_ANGLES + "?mode=" + a.mode; var r = a.chartType || "formats", r = (t += "&chart_type=" + r, !a.service || "windsor" !== a.service && "creator" !== a.service || (t += "&service=" + a.service), a.platform && "all" !== a.platform && (t += "&platform=" + encodeURIComponent(a.platform)), a.adsStatus || "launched"); return "active" !== r && "launched" !== r || (t += "&ads_status=" + r), "function" == typeof msGetData && (t = msGetData(t)), a.dateRange && Array.isArray(a.dateRange) && 2 === a.dateRange.length && "function" == typeof flatDateParam && (t = flatDateParam(t, a.dateRange)), t += "&_t=" + Date.now() } function advGetCachedData(e, a) { return e && a && e._advState && e._advState.rawDataCache && e._advState.rawDataCache[a] || null } function advBuildCacheKey(e, a, t, r, n = "launched", o = "all") { if (!e || !a || !t) return ""; var s = e._advState?.startDate || "", e = e._advState?.endDate || ""; let l = (s && e ? s + "_" + e : "") + "_" + a + "_" + t; return !r || "windsor" !== r && "creator" !== r || (l += "_" + r), !n || "launched" !== n && "active" !== n || (l += "_" + n), o && "all" !== o && (l += "_" + o), l } function advDetectServiceFromUrl(e) { if (e && "string" == typeof e) { e = e.match(/[?&]service=([^&]+)/); if (e && e[1]) { e = e[1].toLowerCase(); if ("windsor" === e || "creator" === e) return e } } return null } function advDetectServiceFromResponse(e) { return e && "object" == typeof e ? e.companies && Array.isArray(e.companies) ? "creator" : void 0 === e.yourCompany || void 0 === e.competitors && !Array.isArray(e.competitors) ? null : "windsor" : null } function advTransformCreatorDataToChart(e) { let l = e.dates || [], a = e.companies || []; var t = e.angles || []; return l.length && a.length && t.length ? (t = t.map(o => { let s = { id: o.toLowerCase().replace(/\s+/g, "-"), label: o, companies: [] }; return a.forEach(e => { let t = e.adsLaunchedByAngle?.[o] || []; var a = l.map((e, a) => void 0 !== t[a] ? t[a] : 0); let r = e.adsLaunchedUniqueByAngle?.[o] || []; var n = l.map((e, a) => void 0 !== r[a] ? r[a] : 0); s.companies.push({ id: e.name?.toLowerCase().replace(/\s+/g, "-") || "company", name: e.name || "Company", color: e.color || "#999999", adsLaunched: a, adsLaunchedUnique: n }) }), s }), { dates: l, channels: t, meta: e.meta || { metricLabels: { adsLaunched: "Ads Launched" }, dimensionLabel: "Category" }, baseMetrics: ["adsLaunched"], helperText: e.helperText || {}, _noHistoricalData: e._noHistoricalData || !1 }) : { dates: l, channels: [], meta: e.meta || {}, baseMetrics: ["adsLaunched"], helperText: e.helperText || {} } } function advTransformAnglesToLineChartFormat(a) { let n = []; if (a.dates && Array.isArray(a.dates) && 0 < a.dates.length) n = a.dates; else { var t = new Date; for (let e = 6; 0 <= e; e--) { var r = new Date(t); r.setDate(r.getDate() - e), n.push(r.toISOString().split("T")[0]) } } let o = new Set; a.yourCompany && a.yourCompany.anglesOffers && Object.keys(a.yourCompany.anglesOffers).forEach(e => { e.startsWith("_") || o.add(e) }), a.competitors && Array.isArray(a.competitors) && a.competitors.forEach(e => { e.anglesOffers && Object.keys(e.anglesOffers).forEach(e => { e.startsWith("_") || o.add(e) }) }); var e, s, l, d = Array.from(o); return 0 === d.length ? { dates: n, channels: [], meta: a.meta || {}, baseMetrics: a.baseMetrics || [] } : (a._advState?.platform, d = d.map(t => { let r = { id: t.toLowerCase().replace(/\s+/g, "-"), label: t, companies: [] }; var e = i(a.yourCompany?.anglesOffersMetrics, t, n); return r.companies.push({ id: "your-company", name: a.yourCompany?.name || "Your Company", color: a.yourCompany?.color || ADV_MAIN_COLOR, adsLaunched: e.adsLaunched, adsLaunchedUnique: e.adsLaunchedUnique, spend: e.spend, revenue: e.revenue, revenuePerAd: e.revenuePerAd, roas: e.roas, linkClicks: e.linkClicks, impressions: e.impressions, ctr: e.ctr }), a.competitors && Array.isArray(a.competitors) && a.competitors.forEach(e => { var a = i(e.anglesOffersMetrics, t, n); r.companies.push({ id: e.name?.toLowerCase().replace(/\s+/g, "-") || "competitor", name: e.name || "Competitor", color: e.color || "#999999", adsLaunched: a.adsLaunched, adsLaunchedUnique: a.adsLaunchedUnique, spend: a.spend, revenue: a.revenue, revenuePerAd: a.revenuePerAd, roas: a.roas, linkClicks: a.linkClicks, impressions: a.impressions, ctr: a.ctr }) }), r }), e = a.yourCompany?.anglesOffersMetrics?._uniqueAdsCount, s = a.yourCompany?.anglesOffersMetrics?._totalSpendUnique, l = a.yourCompany?.anglesOffersMetrics?._totalRevenueUnique, { dates: n, channels: d, meta: a.meta || { metricLabels: { adsLaunched: "Ads Launched", spend: "Total Spend", revenue: "Total Revenue", revenuePerAd: "Rev / Ad", roas: "ROAS" }, dimensionLabel: "Format" }, baseMetrics: a.baseMetrics || ["adsLaunched", "spend", "revenue", "revenuePerAd", "roas"], helperText: a.helperText || {}, _uniqueAdsCount: e, _totalSpendUnique: s, _totalRevenueUnique: l }); function i(e, a, r) { if (e && e[a]) { let t = e[a]; if (t.dates && Array.isArray(t.dates)) { let a = { adsLaunched: [], adsLaunchedUnique: [], spend: [], revenue: [], revenuePerAd: [], roas: [], linkClicks: [], impressions: [], ctr: [] }; return r.forEach(e => { e = t.dates.indexOf(e); -1 !== e ? (a.adsLaunched.push(t.adsLaunched[e] || 0), a.adsLaunchedUnique.push(t.adsLaunchedUnique[e] || 0), a.spend.push(t.spend[e] || 0), a.revenue.push(t.revenue[e] || 0), a.revenuePerAd.push(t.revenuePerAd[e] || 0), a.roas.push(t.roas[e] || 0), a.linkClicks.push(t.linkClicks[e] || 0), a.impressions.push(t.impressions[e] || 0), a.ctr.push(t.ctr[e] || 0)) : (a.adsLaunched.push(0), a.adsLaunchedUnique.push(0), a.spend.push(0), a.revenue.push(0), a.revenuePerAd.push(0), a.roas.push(0), a.linkClicks.push(0), a.impressions.push(0), a.ctr.push(0)) }), a } } return { adsLaunched: new Array(r.length).fill(0), adsLaunchedUnique: new Array(r.length).fill(0), spend: new Array(r.length).fill(0), revenue: new Array(r.length).fill(0), revenuePerAd: new Array(r.length).fill(0), roas: new Array(r.length).fill(0), linkClicks: new Array(r.length).fill(0), impressions: new Array(r.length).fill(0), ctr: new Array(r.length).fill(0) } } } function advGetBaseMetricsConfig(e) { if (!e || "object" != typeof e) return []; let t = []; if (Array.isArray(e.baseMetrics) && e.baseMetrics.length) t = e.baseMetrics.slice(); else { var r = e.channels || []; if (r.length && r[0].companies && r[0].companies[0]) { let a = r[0].companies[0]; t = Object.keys(a).filter(e => Array.isArray(a[e])) } } let n = e.meta?.metricLabels || {}; return t.map(e => { var e = String(e), a = e.toLowerCase(); let t = "number"; return t = a.includes("rate") || "cvr" === a || "ctr" === a ? "percent" : a.includes("revenue") || a.includes("rev") || a.includes("spend") || a.includes("cpo") || a.includes("cac") ? "decimal" : "roas" === a ? "number" : "int", { id: e, key: e, label: n[e] || e, format: t } }) } function advFormatMetricValue(e, a, t = "EUR") { var r, a = Number(a) || 0; return e?.format ? "roas" !== (r = e?.id?.toLowerCase() || "") && "ctr" !== r || 0 !== a ? "roas" === r && "number" === e.format ? a.toFixed(1) + "x" : "percent" === e.format ? (100 * a).toFixed(2) + "%" : "int" === e.format ? Math.round(a).toLocaleString() : "decimal" === e.format ? (r = a.toLocaleString("en-US", { minimumFractionDigits: 2, maximumFractionDigits: 2 }), "EUR" === t ? "€" + r : "USD" === t ? "$" + r : "GBP" === t ? "£" + r : t + " " + r) : a.toFixed(2) : "--" : a.toFixed(2) } async function advLoadNewJSON(e) {
    // [MODIFIED] Mock data interception for FORMATS
    if (e.includes("chart_type=formats")) {
        console.log("[ADV] Intercepting request for FORMATS mock data");
        e = "/public/mock_formats_data.json"; // Use absolute path from root or relative if on same domain
        // If served via CDN or raw git, this might need adjustment, but for local/Webflow usage:
        // Assuming the file is hosted at the root or /public/
        // Let's try to detect if we are using the raw git URL or local
        if (window.location.hostname.includes("webflow.io") || window.location.hostname.includes("foresightiq.ai")) {
            // If on production, maybe point to the CDN link of the mock data?
            // For now, let's use the CDN link to be safe if this script is loaded via CDN.
            e = "https://cdn.jsdelivr.net/gh/nlkieuanh/qure-mock-api@main/public/mock_formats_data.json";
        }
    }

    var a = await fetch(e); if (a.ok) return a.json(); throw new Error("JSON fetch failed " + e)
} function advFilterDateRange(e, a, t) { if (!Array.isArray(e)) return []; let r = a ? new Date(a) : null, n = t ? new Date(t) : null; return r && n ? e.reduce((e, a, t) => { a = new Date(a); return a >= r && a <= n && e.push(t), e }, []) : e.map((e, a) => a) } function advGetMetricSeries(e, a, t, r, n) { e = (e.channels || []).find(e => e.id === a); if (!e) return []; e = (e.companies || []).find(e => e.id === t); if (!e) return []; let o = e[r] || []; return Array.isArray(o) ? n?.length ? n.map(e => o[e]) : o : [] } function advConsolidateChannels(e) { if (!e.length) return []; var a = e[0].length; let t = new Array(a).fill(0); return e.forEach(e => e.forEach((e, a) => t[a] += e)), t } function advToPercentV2(e, t) { return e.map((e, a) => { a = t[a] || 0; return 0 === a ? 0 : e / a * 100 }) } function advBuildChartPayload(e) { let { json: s, channelIds: a, dateIndexes: l, metric: d, mode: t, valueType: r } = e, n = s.dates || []; e = l.map(e => n[e]); let i = {}; var c = (s.channels || []).map(e => e.id); let u = a && 0 < a.length ? a : c; c = (d || "").toLowerCase(); let p = "ctr" === c || "cvr" === c || c.includes("rate"); if ("direct" === t) { let t = u[0]; var o = (s.channels || []).find(e => e.id === t); o && (o.companies || []).forEach(e => { let a = advGetMetricSeries(s, t, e.id, d, l); p && (a = a.map(e => 100 * (e || 0))), i[e.id] = { name: e.name, color: e.color, values: a } }) } else { let n = {}, o = "ctr" === c || "roas" === c; (s.channels || []).forEach(a => { u.includes(a.id) && (a.companies || []).forEach(r => { let e = advGetMetricSeries(s, a.id, r.id, d, l); if (e.length) if (p && (e = e.map(e => 100 * (e || 0))), i[r.id]) { let t = i[r.id].values; o ? (n[r.id] || (n[r.id] = new Array(t.length).fill(0)), e.forEach((e, a) => { t[a] = (t[a] || 0) + (e || 0), 0 < e && n[r.id][a]++ })) : e.forEach((e, a) => t[a] = (t[a] || 0) + (e || 0)) } else i[r.id] = { name: r.name, color: r.color, values: e.slice() }, o && (n[r.id] = new Array(e.length).fill(0), e.forEach((e, a) => { 0 < e && n[r.id][a]++ })) }) }), o && Object.keys(n).forEach(e => { let t = n[e]; var a = i[e].values; i[e].values = a.map((e, a) => { a = t[a] || 0; return 0 < a ? e / a : 0 }) }) } let v = Object.values(i); if ("percent" === r && v.length && !p) { o = v[0].values.length; let t = new Array(o).fill(0); v.forEach(e => e.values.forEach((e, a) => t[a] += e || 0)), v = v.map(e => ({ name: e.name, color: e.color, values: advToPercentV2(e.values, t) })) } let m = v.find(e => "Your Company" === e.name) || v[0] || { name: "", color: "#3366cc", values: [] }; c = v.filter(e => e !== m); return { periods: e, chartType: "line", yourCompany: m, competitors: c } } function advBuildComparisonChartPayload(e) { var { mainJson: e, compareJson: a, channelIds: t, mainDateIndexes: r, compareDateIndexes: n, metric: o, mode: s, valueType: l } = e; let d = e.dates || [], i = a.dates || [], c = [...new Set([...d, ...i])].sort((e, a) => new Date(e) - new Date(a)); e = advBuildChartPayload({ json: e, channelIds: t, dateIndexes: r, metric: o, mode: s, valueType: l }), r = advBuildChartPayload({ json: a, channelIds: t, dateIndexes: n, metric: o, mode: s, valueType: l }); let u = {}, p = (d.forEach((e, a) => { u[e] = a }), {}), v = (i.forEach((e, a) => { p[e] = a }), (a, t, e) => e.map(e => { e = t.indexOf(e); return -1 !== e && a[e] || 0 })); return e.yourCompany && (e.yourCompany.values = v(e.yourCompany.values, d, c)), e.competitors = e.competitors.map(e => ({ ...e, values: v(e.values, d, c) })), r.yourCompany && (r.yourCompany.values = v(r.yourCompany.values, i, c)), r.competitors = r.competitors.map(e => ({ ...e, values: v(e.values, i, c) })), e.periods = c, r.periods = c, { main: e, compare: r } } function advRenderLineChart(t, l, d, i = !1, c = null, u = null, p = null) { if (window.Chart) { var v = t.getContext("2d"), m = (t._advChartInstance && t._advChartInstance.destroy(), [...l.yourCompany?.values || [], ...(l.competitors || []).flatMap(e => e.values || [])]), m = (c && m.push(...c.yourCompany?.values || [], ...(c.competitors || []).flatMap(e => e.values || [])), m.some(e => 0 < e && e < 10)), m = "percent" === d && m; let n = [], a = null !== c, o = [], r = [], e = [], s = []; if (a && c) { var h = l.periods; if (u && 0 < u.length && p && 0 < p.length) { o = u, r = p; let a = e => "string" == typeof e ? e : e instanceof Date ? e.toISOString().split("T")[0] : String(e), t = h.map(a); var f = u.map(e => { e = a(e); return t.indexOf(e) }).filter(e => -1 !== e), y = p.map(e => { e = a(e); return t.indexOf(e) }).filter(e => -1 !== e); l.yourCompany?.values?.length && (e = f.map(e => l.yourCompany.values[e] || 0)), c.yourCompany?.values?.length && (s = y.map(e => c.yourCompany.values[e] || 0)) } else { let a = h.length; for (let e = 0; e < h.length - 1; e++) { var g = new Date(h[e]); if (1 < (new Date(h[e + 1]) - g) / 864e5) { a = e + 1; break } } o = h.slice(0, a), r = h.slice(a), l.yourCompany?.values?.length && (e = l.yourCompany.values.slice(0, a)), c.yourCompany?.values?.length && (s = c.yourCompany.values.slice(a)) } l.yourCompany?.values?.length && e.length && n.push({ label: l.yourCompany.name + " (Primary period)", data: e, xAxisID: "x-main", borderColor: ADV_MAIN_COLOR, backgroundColor: advHexToRgba(ADV_MAIN_COLOR, .15), borderWidth: 2, borderDash: [], tension: .3, pointRadius: i ? 6 : 0, pointHoverRadius: i ? 8 : 0, fill: !0 }), (l.competitors || []).forEach(t => { let e = []; if (u && 0 < u.length) { let a = l.periods; var r = u.map(e => a.indexOf(e)).filter(e => -1 !== e); e = r.map(e => t.values[e] || 0) } else { r = o.length; e = t.values.slice(0, r) } e.length && n.push({ label: t.name + " (Primary period)", data: e, xAxisID: "x-main", borderColor: t.color, backgroundColor: advHexToRgba(t.color, .1), borderWidth: 1.5, borderDash: [], tension: .3, pointRadius: i ? 5 : 0, pointHoverRadius: i ? 7 : 0, fill: !1 }) }), c.yourCompany?.values?.length && s.length && (f = ADV_COMPARE_COLOR, n.push({ label: c.yourCompany.name + " (Comparison period)", data: s, xAxisID: "x-compare", borderColor: f, backgroundColor: advHexToRgba(f, .05), borderWidth: 2, borderDash: [5, 5], tension: .3, pointRadius: i ? 6 : 0, pointHoverRadius: i ? 8 : 0, fill: !1 })), (c.competitors || []).forEach(t => { let e = []; if (p && 0 < p.length) { let a = l.periods; var r = p.map(e => a.indexOf(e)).filter(e => -1 !== e); e = r.map(e => t.values[e] || 0) } else { r = o.length; e = t.values.slice(r) } e.length && (r = ADV_COMPARE_COLOR, n.push({ label: t.name + " (Comparison period)", data: e, xAxisID: "x-compare", borderColor: r, backgroundColor: advHexToRgba(r, .05), borderWidth: 1.5, borderDash: [5, 5], tension: .3, pointRadius: i ? 5 : 0, pointHoverRadius: i ? 7 : 0, fill: !1 })) }) } else l.yourCompany?.values?.length && n.push({ label: l.yourCompany.name, data: l.yourCompany.values, borderColor: l.yourCompany.color || "#3366cc", backgroundColor: advHexToRgba(l.yourCompany.color || "#3366cc", .15), borderWidth: 2, borderDash: [], tension: .3, pointRadius: i ? 6 : 0, pointHoverRadius: i ? 8 : 0, fill: !0 }), (l.competitors || []).forEach(e => { n.push({ label: e.name, data: e.values, borderColor: e.color, backgroundColor: advHexToRgba(e.color, .1), borderWidth: 1.5, borderDash: [], tension: .3, pointRadius: i ? 5 : 0, pointHoverRadius: i ? 7 : 0, fill: !1 }) }); y = { labels: a && c ? o : l.periods, datasets: n }; t._advChartInstance = new Chart(v, { type: "line", data: y, options: { responsive: !0, maintainAspectRatio: !1, interaction: { mode: "index", intersect: !1 }, plugins: { legend: { position: "bottom" }, tooltip: { enabled: !0, callbacks: { label: e => { var a = e.dataset.label || "", e = e.parsed.y; return "percent" === d ? `${a}: ${e.toFixed(1)}%` : a + ": " + e.toLocaleString() } } } }, scales: { y: { beginAtZero: !0, max: "percent" !== d || m ? void 0 : 100, ticks: { callback: e => "percent" === d ? e + "%" : e } }, ...a && c && 0 < o.length && 0 < r.length ? { "x-main": { type: "category", position: "bottom", labels: o.map(e => { return new Date(e).toLocaleDateString("en-US", { month: "short", day: "numeric" }) }), title: { display: !1 }, ticks: { color: "#666666" }, grid: { display: !1 } }, "x-compare": { type: "category", position: "top", labels: r.map(e => { return new Date(e).toLocaleDateString("en-US", { month: "short", day: "numeric" }) }), title: { display: !1 }, ticks: { color: "#666666" }, grid: { display: !1 } } } : { x: { ticks: { callback: function (e, a) { a = l.periods[a]; return a ? new Date(a).toLocaleDateString("en-US", { month: "short", day: "numeric" }) : "" }, maxTicksLimit: 12 } } } }, animation: { onComplete: function () { if (i && this && this.tooltip) { let t = []; var e; n.forEach((e, a) => { e.data && 0 < e.data.length && t.push({ datasetIndex: a, index: 0 }) }), 0 < t.length && (e = this.getDatasetMeta(0)) && e.data && 0 < e.data.length && (e = e.data[0], this.tooltip.setActiveElements(t, { x: e.x, y: e.y }), this.update("none")) } a && c && 0 < o.length && 0 < r.length && setTimeout(() => { var e; t && t.parentElement && (e = t.parentElement) && e.classList.add("adv-comparison-mode") }, 100) } }, plugins: { ...a && c && 0 < o.length && 0 < r.length ? { afterDraw: r => { let n = r.ctx, o = r.scales["x-main"], s = r.scales["x-compare"]; o && o.ticks.forEach((e, a) => { var a = o.getPixelForValue(a), t = r.chartArea.bottom + o.options.ticks.padding + 5; n.save(), n.strokeStyle = ADV_MAIN_COLOR, n.lineWidth = 2, n.beginPath(), n.moveTo(a - 15, t), n.lineTo(a + 15, t), n.stroke(), n.restore() }), s && s.ticks.forEach((e, a) => { var a = s.getPixelForValue(a), t = r.chartArea.top - s.options.ticks.padding - 5; n.save(), n.strokeStyle = ADV_COMPARE_COLOR, n.lineWidth = 2, n.beginPath(), n.moveTo(a - 15, t), n.lineTo(a + 15, t), n.stroke(), n.restore() }) } } : {} } } }), i && t._advChartInstance && setTimeout(() => { var e, a = t._advChartInstance; if (a && a.tooltip) { let t = []; n.forEach((e, a) => { e.data && 0 < e.data.length && t.push({ datasetIndex: a, index: 0 }) }), 0 < t.length && (e = a.getDatasetMeta(0)) && e.data && 0 < e.data.length && (e = e.data[0], a.tooltip.setActiveElements(t, { x: e.x, y: e.y }), a.update("none")) } }, 300) } } function advInitCompanyDropdown(e, t) { Array.isArray(t) && t.length && e.querySelectorAll(".company-dd-link-select").forEach(e => { let a = e.querySelector(".company-select-script"), r = a ? a.parentElement : e;[...r.children].forEach(e => { e !== a && r.removeChild(e) }), t.forEach(e => { var a = document.createElement("div"), t = (a.className = "filter-dropdown-item", a.dataset.dropdown = e.id, document.createElement("div")); t.className = "dropdown-item-text", t.textContent = e.name, a.appendChild(t), r.appendChild(a) }); e = e.querySelector(".company-dd-selected"); e && (e.textContent = t[0].name) }) } function advApplyCompanySelection(e) { var a, t, r = e.closest(".company-dd-link-select"); r && (a = e.dataset.dropdown, t = e.querySelector(".dropdown-item-text")?.textContent.trim() || "", (r = r.querySelector(".company-dd-selected")) && (r.textContent = t), r = (e.closest(".w-tab-pane") || e.closest(".card-block-wrap")).querySelector(".chart-canvas")?._advController) && r.setCompany(a) } function advInitMetricDropdown(e, t, n) { t?.length && e.querySelectorAll(".chart-metric-dd-select").forEach(e => { let a = e.querySelector(".chart-metric-select-script"), r = a ? a.parentElement : e;[...r.children].forEach(e => { e !== a && r.removeChild(e) }), t.forEach(e => { var a = document.createElement("div"), t = (a.className = "filter-dropdown-item", a.dataset.dropdown = e, document.createElement("div")); t.className = "dropdown-item-text", t.textContent = n[e] || e, a.appendChild(t), r.appendChild(a) }); e = e.querySelector(".chart-metric-dd-selected"); e && (e.textContent = n[t[0]] || t[0]) }) } function advApplyMetricSelection(e) { var a, t, r = e.closest(".chart-metric-dd-select"); r && (a = e.dataset.dropdown, t = e.querySelector(".dropdown-item-text")?.textContent.trim(), (r = r.querySelector(".chart-metric-dd-selected")) && (r.textContent = t), (r = (e.closest(".w-tab-pane") || e.closest(".card-block-wrap")).querySelector(".chart-canvas"))?._advComparisonMode && r._advComparisonSetMetric ? (r._advComparisonSetMetric(a), (t = r.closest(".card-block-wrap")) && !t._advState && (t._advState = {}), t && t._advState && (t._advState.metric = a)) : (e = r?._advController) && e.setMetric(a)) } function advInitChartV2(g, S) { let o = g.querySelector("canvas"); if (o) if (g._advComparisonMode) console.log("[ADV] Skipping regular chart init - comparison mode active"); else if (S && S.startsWith("blob:")) { "function" == typeof hideChartNoDataMessage && hideChartNoDataMessage(g); let y = g.closest(".card-block-wrap") || document; if (g._advComparisonMode) console.log("[ADV] Skipping regular chart controller init - comparison mode active"); else { y._advTabControllers || (y._advTabControllers = []), y._advTabControllers.includes(g) || y._advTabControllers.push(g); let d = null; var e = g.closest(".tab-content-flex"); d = (e || g.closest(".w-tab-pane") || g.closest(".card-block-wrap")).querySelector(".table-render"); let i = null, c = [], u = "netRevenue", p = "absolute", v = "direct", m = null, h = null, f = null; function t(t) { if (g._advComparisonMode) console.log("[ADV] Skipping regular renderChart - comparison mode active"); else if (i) { Array.isArray(t) && t.length || (t = (i.dates || []).map((e, a) => a)); let e = (u || "").toLowerCase(), a = "ctr" === e || "cvr" === e || e.includes("rate") ? "percent" : p; var r, n = advBuildChartPayload({ json: i, channelIds: c, dateIndexes: t, metric: u, mode: "consolidate", valueType: a }); if (advIsChartPayloadEmpty(n)) { if (!!o._advChartInstance && i) { let e = !1; for (r of i.baseMetrics || []) if (r !== u) if (!advIsChartPayloadEmpty(advBuildChartPayload({ json: i, channelIds: c, dateIndexes: t, metric: r, mode: "consolidate", valueType: p }))) { e = !0; break } if (e) return "function" == typeof hideChartNoDataMessage && hideChartNoDataMessage(g), void (o._advChartInstance && (o._advChartInstance.destroy(), o._advChartInstance = null)) } "function" == typeof hideChartSingleDayMessage && hideChartSingleDayMessage(g), o._advChartInstance && (o._advChartInstance.destroy(), o._advChartInstance = null), "function" == typeof hideChartNoDataMessage && hideChartNoDataMessage(g), "function" == typeof showChartNoDataMessage && showChartNoDataMessage(g), 0 < c.length || advClearTable(g) } else { if ("function" == typeof hideChartNoDataMessage && hideChartNoDataMessage(g), 1 === t.length) { "function" == typeof showChartSingleDayMessage && showChartSingleDayMessage(g); let e = (u || "").toLowerCase(), a = "ctr" === e || "cvr" === e || e.includes("rate") ? "percent" : p; advRenderLineChart(o, n, a, !0) } else { "function" == typeof hideChartSingleDayMessage && hideChartSingleDayMessage(g); let e = (u || "").toLowerCase(), a = "ctr" === e || "cvr" === e || e.includes("rate") ? "percent" : p; advRenderLineChart(o, n, a, !1) } !0 === i._noHistoricalData || void 0 === i._noHistoricalData && !0 === g._advNoHistoricalData ? (g._advNoHistoricalData = !0, setTimeout(() => { showNoHistoricalDataMessage(g) }, 500)) : !1 === i._noHistoricalData && (g._advNoHistoricalData = !1, hideNoHistoricalDataMessage(g)) } } } function C(e) { var a; g._advComparisonMode ? console.log("[ADV] Skipping regular renderChartAndTable - comparison mode active") : i && (y._advState?.startDate && y._advState?.endDate && (h = y._advState.startDate, f = y._advState.endDate), y._advState?.metric && (u = y._advState.metric), void 0 !== y._advState?.channels && null !== y._advState?.channels && (c = Array.isArray(y._advState.channels) ? y._advState.channels.slice() : []), t(a = advFilterDateRange(i.dates || [], h, f)), e) && d?._advRebuildTable && d._advRebuildTable(m, a, c) } g._advComparisonMode ? console.log("[ADV] Skipping JSON load - comparison mode active") : (advLoadNewJSON(S).then(n => { void 0 !== (i = n)._noHistoricalData && (g._advNoHistoricalData = n._noHistoricalData); var n = i.dates || [], o = i.channels || []; if (n.length && o.length) { f = y._advState?.startDate && y._advState?.endDate ? (h = y._advState.startDate, y._advState.endDate) : (s = function (t) { var r = g.closest(".card-block-wrap"); if (r) { r = r.querySelector(".date-range-dd-select"); if (r) { r = r.querySelector('[data-default="1"]'); if (r) { r = r.getAttribute("data-dropdown"); let e = new Date(t[t.length - 1]), a = new Date(e); return "lastWeek" === r ? a.setDate(a.getDate() - 6) : "lastMonth" === r ? a.setDate(a.getDate() - 29) : "lastYear" === r ? a.setDate(a.getDate() - 364) : a.setDate(a.getDate() - 6), { start: advToISODate(a), end: advToISODate(e) } } } } let e = new Date(t[t.length - 1]), a = new Date(e); return a.setDate(a.getDate() - 6), { start: advToISODate(a), end: advToISODate(e) } }(n), h = s.start, s.end), y._advDateBounds = { min: n[0], max: n[n.length - 1] }; let a = o[0], e = (a?.companies?.length && (s = a.companies.map(e => ({ id: e.id, name: e.name })), advInitCompanyDropdown(g.closest(".w-tab-pane") || g.closest(".tab-content-flex") || y, s), m = y._advState?.company ? y._advState.company : s[0].id), !1), t = (g._advServiceType ? e = "creator" === g._advServiceType : (e = "creator" === advDetectServiceFromResponse(i)) || !S || "string" != typeof S || S.startsWith("blob:") || (e = "creator" === advDetectServiceFromUrl(S)), []); e ? t = ["adsLaunched"] : i.baseMetrics?.length ? t = i.baseMetrics.slice() : a?.companies?.length && (t = Object.keys(a.companies[0]).filter(e => Array.isArray(a.companies[0][e]))); n = g._advServiceType || (e ? "creator" : "windsor"), o = i.meta?.metricLabels || {}; let r = y._advState?.adsStatus || (S.includes("ads_status=active") ? "active" : "launched"); "creator" !== n || o.adsLaunched || (o.adsLaunched = "Ads Launched"), "windsor" !== n || o.adsLaunched || (o.adsLaunched = "active" === r ? "Ads Active" : "Ads Launched"); var s = g._advServiceType || (e ? "creator" : "windsor"), n = g.closest(".w-tab-pane") || g.closest(".tab-content-flex") || y; if ("creator" === s) { s = n.querySelector(".chart-metric-dd-select"); s && ((l = s.querySelector(".chart-metric-dd-selected")) && (l.textContent = "Ads Launched"), s.classList.add("my-hidden"), s.style.display = "none") } else { var l = n.querySelector(".chart-metric-dd-select"); l && (l.classList.remove("my-hidden"), l.style.display = ""), advInitMetricDropdown(n, t, o); y._advState?.adsStatus || S.includes("ads_status=active"); s = l.querySelector(".chart-metric-dd-selected"); s && o.adsLaunched && (s.textContent = o.adsLaunched) } n = g._advServiceType || (e ? "creator" : "windsor"), o = (u = "creator" === n ? "adsLaunched" : y._advState?.metric && t.includes(y._advState.metric) ? y._advState.metric : t[0] || "netRevenue", c = y._advState?.channels?.length ? y._advState.channels.slice() : [], d && !d._advRebuildTable && ("creator" === (l = g._advServiceType || (e ? "creator" : "windsor")) && "function" == typeof advInitTableCreator ? (s = g._advOriginalApiUrl || S, advInitTableCreator(d, s)) : "function" == typeof advInitTable ? advInitTable(d, S) : console.warn("[ADV] No table renderer available. Service type:", l)), C(!0), d && !d._advCheckboxBound && (d._advCheckboxBound = !0, d.addEventListener("change", e => { let a = e.target.closest(".adv-channel-checkbox"); var t, r; a && (e = a.closest("tbody")) && (t = a.dataset.advChannel) && (e = [...e.querySelectorAll(".adv-channel-checkbox")], (r = d.closest(".w-tab-pane") || d.closest(".tab-content-flex")?.closest(".w-tab-pane")) && "your-company" === r.getAttribute("data-w-tab") ? c = a.checked ? (e.forEach(e => { e !== a && (e.checked = !1) }), [t]) : [] : a.checked ? c.includes(t) || c.push(t) : -1 < (r = c.indexOf(t)) && c.splice(r, 1), y._advState && (y._advState.channels = c.slice()), C(!0)) })), d && !d._advRowClickBound && (d._advRowClickBound = !0, d.addEventListener("click", e => { var a, t = e.target.closest("tr"); !t || (a = t.closest("table")) && a.closest(".adv-comparison-mode") || (a = d.closest(".table-render")) && a._advTableState && a._advTableState.comparisonMode || !(a = t.querySelector(".adv-channel-checkbox")) || e.target.closest(".adv-channel-checkbox") || e.target.closest(".target-text") || (a.checked = !a.checked, t = new Event("change", { bubbles: !0 }), a.dispatchEvent(t)) })), g.querySelector(".chart-switch-mode-btn")), n = g.querySelector(".chart-switch-value-btn"); if (o) { let e = o.querySelector(".btn-direct"), a = o.querySelector(".btn-consolidate"); e && e.addEventListener("click", () => { v = "direct", e.classList.add("is-active"), a?.classList.remove("is-active"), C() }), a && a.addEventListener("click", () => { v = "consolidate", a.classList.add("is-active"), e?.classList.remove("is-active"), C() }) } if (n) { let e = n.querySelector(".btn-absolute"), a = n.querySelector(".btn-percent"); e && e.addEventListener("click", () => { p = "absolute", e.classList.add("is-active"), a?.classList.remove("is-active"), C() }), a && a.addEventListener("click", () => { p = "percent", a.classList.add("is-active"), e?.classList.remove("is-active"), C() }) } } else console.error("[ADV] Missing dates or channels:", S), "function" == typeof showChartNoDataMessage && showChartNoDataMessage(g), advClearTable(g) }).catch(e => console.error("[ADV] JSON load error", e)), g._advController = { setDateRange(e, a) { h = e, f = a, y._advState && (y._advState.startDate = e, y._advState.endDate = a), i && (t(e = advFilterDateRange(i.dates || [], h, f)), d?._advRebuildTable) && d._advRebuildTable(m, e, c) }, setChannels(e) { Array.isArray(e) && (c = e.slice()), y._advState && (y._advState.channels = c.slice()), C() }, setCompany(e) { var a; m = e, y._advState && (y._advState.company = e), i && (a = advFilterDateRange(i.dates || [], h, f), d?._advRebuildTable) && d._advRebuildTable(e, a, c) }, setMetric(e) { u = e, y._advState && (y._advState.metric = e), C() }, get _advStartDate() { return h }, get _advEndDate() { return f }, get _advMetric() { return u }, get _advCompany() { return m }, get _advChannels() { return c }, get _advJsonData() { return i } }) } } else { let i = g.closest(".card-block-wrap") || document; "function" == typeof hideChartNoDataMessage && hideChartNoDataMessage(g), "function" == typeof showChartLoadingMessage && showChartLoadingMessage(g), void fetch(S).then(e => e.json()).then(n => { var o = "creator" === advDetectServiceFromResponse(n) || "creator" === advDetectServiceFromUrl(S); let e = !1; if (e = o ? !(s = n.companies || []).length || !s.some(e => { return (e.adsLaunched || []).some(e => 0 < e) }) : advIsAnglesDataEmpty(n)) "function" == typeof hideChartLoadingMessage && hideChartLoadingMessage(g), "function" == typeof showChartNoDataMessage && showChartNoDataMessage(g), advClearTable(g); else { i._advState || (i._advState = {}); let e = ""; n.dates && Array.isArray(n.dates) && 0 < n.dates.length ? (s = n.dates[0], l = n.dates[n.dates.length - 1], e = s + "_" + l, i._advState.startDate = s, i._advState.endDate = l) : e = (i._advState.startDate || "") + "_" + (i._advState.endDate || ""); let a = "competitor", t = (S.includes("mode=best_in_class") ? a = "best_in_class" : S.includes("mode=your_company") && (a = "your_company"), "formats"); S.includes("chart_type=offers") ? t = "offers" : S.includes("chart_type=use_cases") && (t = "use_cases"); var s = advDetectServiceFromUrl(S) || (o ? "creator" : "windsor"), l = S.includes("ads_status=active") ? "active" : !S.includes("ads_status=launched") && i._advState?.adsStatus || "launched", d = S.includes("platform=") ? S.match(/platform=([^&]+)/)?.[1] || "all" : i._advState?.platform || "all", s = advBuildCacheKey(i, a, t, s, l, d); i._advState.rawDataCache || (i._advState.rawDataCache = {}), i._advState.rawDataCache[s] = JSON.parse(JSON.stringify(n)), i._advState && (i._advState.channels = []); let r; r = (o ? advTransformCreatorDataToChart : advTransformAnglesToLineChartFormat)(n), n.meta && (r.meta = n.meta), n.baseMetrics && (r.baseMetrics = n.baseMetrics), void 0 !== n._noHistoricalData && (r._noHistoricalData = n._noHistoricalData, g._advNoHistoricalData = n._noHistoricalData), o ? (g._advOriginalApiUrl = S, g._advServiceType = "creator") : g._advServiceType = "windsor", g._advCurrentBlobUrl && URL.revokeObjectURL(g._advCurrentBlobUrl); l = new Blob([JSON.stringify(r)], { type: "application/json" }), d = URL.createObjectURL(l), s = (g._advCurrentBlobUrl = d, "function" == typeof hideChartLoadingMessage && hideChartLoadingMessage(g), g.closest(".tab-content-flex")); s && (n = s.querySelector(".table-render")) && (delete n._advRebuildTable, o = (n.querySelector(".adv-channel-table-wrapper") || n).querySelector(".adv-channel-table")) && (o.innerHTML = ""), g._advComparisonMode ? console.log("[ADV] Skipping blob URL chart init - comparison mode active") : advInitChartV2(g, d) } }).catch(e => { console.error("[ADV] Chart API error:", e), "function" == typeof hideChartLoadingMessage && hideChartLoadingMessage(g), "function" == typeof showChartNoDataMessage && showChartNoDataMessage(g), advClearTable(g) }) } else console.error("[ADV] Canvas not found") } function advInitChartV2Comparison(i, c, e) { if (i && c && e && i.querySelector("canvas")) { let d = i.closest(".card-block-wrap"); d && ("function" == typeof showChartLoadingMessage && showChartLoadingMessage(i), Promise.all([fetch(c).then(e => e.json()), fetch(e).then(e => e.json())]).then(([n, o]) => { var s = "creator" === advDetectServiceFromResponse(n); let e = !1; if (e = s ? advIsTransformedDataEmpty(n) && advIsTransformedDataEmpty(o) : advIsAnglesDataEmpty(n) && advIsAnglesDataEmpty(o)) "function" == typeof hideChartLoadingMessage && hideChartLoadingMessage(i), "function" == typeof showChartNoDataMessage && showChartNoDataMessage(i), advClearTable(i); else { let e, a; s ? (e = advTransformCreatorDataToChart(n), a = advTransformCreatorDataToChart(o), (n._noHistoricalData || o._noHistoricalData) && (i._advNoHistoricalData = !0)) : (e = advTransformAnglesToLineChartFormat(n), a = advTransformAnglesToLineChartFormat(o)), n.meta && (e.meta = n.meta), n.baseMetrics && (e.baseMetrics = n.baseMetrics), i._advComparisonMode = !0, i._advController && (console.log("[ADV] Clearing regular chart controller for comparison mode"), delete i._advController); var l = i.querySelector("canvas"), l = (l && l._advChartInstance && (l._advChartInstance.destroy(), l._advChartInstance = null), i._advMainData = e, i._advCompareData = a, i._advServiceType = s ? "creator" : "windsor", i._advOriginalApiUrl = c, "function" == typeof hideChartLoadingMessage && hideChartLoadingMessage(i), i.closest(".tab-content-flex")); let t = i.closest(".w-tab-pane"), r = null; if (l) r = l.querySelector(".table-render"); else if (t) r = t.querySelector(".table-render"); else { let e = i.closest(".card-block-wrap"); e && (r = e.querySelector(".table-render")) } if (r && (r._advRebuildTable = null), r && ("creator" === i._advServiceType && "function" == typeof advInitTableCreator ? advInitTableCreator(r, null, null, n, o) : "function" == typeof advInitTable ? advInitTable(r, null, null, n, o) : console.error("[ADV] advInitTable function not found!")), !s) { let e = i.closest(".w-tab-pane") || i.closest(".tab-content-flex") || d; l = e?.querySelector(".chart-metric-dd-select"); l && (o = n.baseMetrics || ["adsLaunched", "spend", "revenue", "revenuePerAd", "roas", "ctr"], s = n.meta?.metricLabels || { adsLaunched: "Ads Launched", spend: "Total Spend", revenue: "Total Revenue", revenuePerAd: "Rev / Ad", roas: "ROAS", ctr: "CTR" }, "active" === (d._advState?.adsStatus || "launched") && s.adsLaunched && (s.adsLaunched = "Ads Active"), advInitMetricDropdown(e, o, s), n = l.querySelector(".chart-metric-dd-selected")) && s.adsLaunched && (n.textContent = s.adsLaunched) } initComparisonChartController(i, e, a), setTimeout(() => { var e, a = i.closest(".tab-content-flex"), a = a ? a.querySelector(".table-render") : null; a && (e = a.querySelector(".adv-channel-table")) && ("function" == typeof window.connectComparisonTableHandlers ? window.connectComparisonTableHandlers(a, e) : console.error("[ADV] connectComparisonTableHandlers function not found")) }, 100) } }).catch(e => { console.error("[ADV] Comparison chart initialization error", e), "function" == typeof hideChartLoadingMessage && hideChartLoadingMessage(i) })) } } function initComparisonChartController(u, p, v) { let m = u.querySelector("canvas"); if (m) { var e = u.closest(".card-block-wrap") || document; let o = "adsLaunched"; e._advState && e._advState.metric ? o = e._advState.metric : (a = e.querySelector(".chart-metric-dd-selected")) && ((a = a.textContent.trim().toLowerCase()).includes("revenue") || a.includes("net revenue") ? o = "netRevenue" : a.includes("spend") || a.includes("total spend") ? o = "spend" : a.includes("ads launched") || a.includes("ads active") || a.includes("ads") ? o = "adsLaunched" : a.includes("roas") ? o = "roas" : a.includes("ctr") && (o = "ctr")); const h = e.querySelector(".btn-percent.is-active") ? "percent" : "absolute"; e.querySelector(".btn-consolidate.is-active"); const f = "consolidate"; let s = [], l = null; var a = p.dates || [], e = v.dates || [], t = [...new Set([...a, ...e])].sort((e, a) => new Date(e) - new Date(a)); t[0], t[t.length - 1]; let d = a.map((e, a) => a), i = e.map((e, a) => a); t = u.closest(".tab-content-flex"); let c = t ? t.querySelector(".table-render") : null; function r(e = 0) { var a = s && 0 < s.length ? s : [], a = advBuildComparisonChartPayload({ mainJson: p, compareJson: v, channelIds: a, mainDateIndexes: d, compareDateIndexes: i, metric: o, mode: f, valueType: h }), t = p.dates || [], r = v.dates || [], n = 1 === d.length, n = (advRenderLineChart(m, a.main, h, n, a.compare, t, r), !0 === u._advNoHistoricalData); (n ? showNoHistoricalDataMessage : hideNoHistoricalDataMessage)(u), c && c._advRebuildTable && c._advRebuildTable(l, d, s) } r(!0), u._advComparisonRender = r, u._advComparisonSetChannels = e => { s = Array.isArray(e) ? e.slice() : [], r() }, u._advComparisonSetMetric = e => { o = e, r() }, u._advComparisonSetValueType = e => { h = e, r() }, u._advComparisonSetMode = e => { f = e, r() }, u._advComparisonSetCompany = e => { l = e, r() } } } function advFindTabPane(e, a) { var t, r = e.querySelector(`.w-tab-pane[data-w-tab="${a}"]`); return r || (r = [...e.querySelectorAll(".w-tab-link")], e = [...e.querySelectorAll(".w-tab-pane")], (t = r.find(e => e.getAttribute("data-w-tab") === a)) && e[r.indexOf(t)]) || null } function advGetChartWrappers(e) { var a; return e ? 0 === (a = e.querySelectorAll(".tab-content-flex .chart-canvas")).length ? Array.from(e.querySelectorAll(".chart-canvas")) : Array.from(a) : [] } function advGetTableWrappers(e) { return e ? [...e.querySelectorAll(".table-render, .tab-content-flex .table-render")] : [] } async function advApplyPlatformToBlock(l, d, i = !1) { if (l && l.classList.contains("card-adv")) { let r = "formats", n = (l.classList.contains("section-offers") ? r = "offers" : l.classList.contains("section-usecases") ? r = "use_cases" : l.classList.contains("section-formats") && (r = "formats"), null); if (l._advState?.startDate && l._advState?.endDate) { var c = l._advState.startDate.includes("T") ? l._advState.startDate.split("T")[0] : l._advState.startDate, u = l._advState.endDate.includes("T") ? l._advState.endDate.split("T")[0] : l._advState.endDate; n = [new Date(c), new Date(u)], l._advState.startDate = c, l._advState.endDate = u } else { var c = l.querySelector(".date-range-dd-select"); let e = 6; c && (u = c.querySelector('[data-default="1"]')) && ("lastWeek" === (c = u.getAttribute("data-dropdown")) ? e = 6 : "lastMonth" === c ? e = 29 : "lastYear" === c && (e = 364)); u = new Date, c = new Date; c.setDate(c.getDate() - e), n = [c, u], l._advState || (l._advState = {}), l._advState.startDate = advToISODate(c), l._advState.endDate = advToISODate(u) } l._advState || (l._advState = {}), l._advState.platform = d || "all", l._advTabControllers = []; let t = advFindTabPane(l, "competitors"), o = advFindTabPane(l, "best-in-class"), s = advFindTabPane(l, "your-company");[t, o, s].forEach(e => { e && advGetTableWrappers(e).forEach(e => { e && delete e._advRebuildTable }) }); c = () => { var e = advGetChartWrappers(s); if (0 < e.length) { e = e[0]; if ("function" == typeof hideChartNoDataMessage && hideChartNoDataMessage(e), l._advState?.compareMode && l._advState?.mainDateRange && l._advState?.compareDateRange) { var a = Array.isArray(l._advState.mainDateRange) && 2 === l._advState.mainDateRange.length ? l._advState.mainDateRange.map(e => e instanceof Date ? e : new Date(e)) : null, t = Array.isArray(l._advState.compareDateRange) && 2 === l._advState.compareDateRange.length ? l._advState.compareDateRange.map(e => e instanceof Date ? e : new Date(e)) : null; if (a && t && "function" == typeof window.updateAnglesChartsWithComparison) return void window.updateAnglesChartsWithComparison(l, a, t) } a = l._advState?.adsStatus || "launched"; advInitChartV2(e, advBuildApiUrl(l, { mode: "your_company", chartType: r, service: "windsor", dateRange: n, platform: d, adsStatus: a })) } }; let e = () => { var e, a = advGetChartWrappers(t); 0 < a.length && (a = a[0], "function" == typeof hideChartNoDataMessage && hideChartNoDataMessage(a), e = l._advState?.adsStatus || "launched", advInitChartV2(a, advBuildApiUrl(l, { mode: "competitor", chartType: r, service: "creator", dateRange: n, platform: d, adsStatus: e }))) }, a = () => { var e, a = advGetChartWrappers(o); 0 < a.length && (a = a[0], "function" == typeof hideChartNoDataMessage && hideChartNoDataMessage(a), e = l._advState?.adsStatus || "launched", advInitChartV2(a, advBuildApiUrl(l, { mode: "best_in_class", chartType: r, service: "creator", dateRange: n, platform: d, adsStatus: e }))) }; u = Date.now(); i ? (l._advState || (l._advState = {}), l._advState.staggeredLoadingInProgress = !0, l._advState.staggeredLoadingStartTime = u, c(), setTimeout(() => { e() }, 3e3), setTimeout(() => { a(), setTimeout(() => { l._advState && (l._advState.staggeredLoadingInProgress = !1) }, 1e3) }, 5e3)) : (c(), e(), a()) } } async function advApplyAdsStatusToBlock(t, n) { if (t && t.classList.contains("card-adv")) { let e = "formats", a = (t.classList.contains("section-offers") ? e = "offers" : t.classList.contains("section-usecases") ? e = "use_cases" : t.classList.contains("section-formats") && (e = "formats"), null); if (t._advState?.startDate && t._advState?.endDate) { var o = t._advState.startDate.includes("T") ? t._advState.startDate.split("T")[0] : t._advState.startDate, s = t._advState.endDate.includes("T") ? t._advState.endDate.split("T")[0] : t._advState.endDate; a = [new Date(o), new Date(s)], t._advState.startDate = o, t._advState.endDate = s } else { var o = t.querySelector(".date-range-dd-select"); let e = 6; o && (s = o.querySelector('[data-default="1"]')) && ("lastWeek" === (o = s.getAttribute("data-dropdown")) ? e = 6 : "lastMonth" === o ? e = 29 : "lastYear" === o && (e = 364)); s = new Date, o = new Date; o.setDate(o.getDate() - e), a = [o, s], t._advState || (t._advState = {}), t._advState.startDate = advToISODate(o), t._advState.endDate = advToISODate(s) } var o = t._advState?.platform || "all", s = (t._advState || (t._advState = {}), t._advState.adsStatus = n || "launched", t._advState.metric && delete t._advState.metric, t._advTabControllers = [], advFindTabPane(t, "competitors")), l = advFindTabPane(t, "best-in-class"), d = advFindTabPane(t, "your-company");[s, l, d].forEach(e => { e && advGetChartWrappers(e).forEach(e => { e && delete e._advController }) }); let r = "active" === n ? "Ads Active" : "Ads Launched";[s, l, d].forEach(e => { var a, t; e && ((a = e.querySelector(".chart-metric-dd-select")) && (a = a.querySelector(".chart-metric-dd-selected")) && ("Ads Launched" === (t = a.textContent.trim()) || "Ads Active" === t) && (a.textContent = r, t = e.querySelector(".chart-canvas")?._advController) && t._advMetric, advGetTableWrappers(e).forEach(e => { e && delete e._advRebuildTable })) }); s = advGetChartWrappers(s), s = (0 < s.length && (s = s[0], "function" == typeof hideChartNoDataMessage && hideChartNoDataMessage(s), advInitChartV2(s, advBuildApiUrl(t, { mode: "competitor", chartType: e, service: "creator", dateRange: a, platform: o, adsStatus: n }))), advGetChartWrappers(l)), s = (0 < s.length && (l = s[0], "function" == typeof hideChartNoDataMessage && hideChartNoDataMessage(l), advInitChartV2(l, advBuildApiUrl(t, { mode: "best_in_class", chartType: e, service: "creator", dateRange: a, platform: o, adsStatus: n }))), advGetChartWrappers(d)); if (0 < s.length) { l = s[0]; if ("function" == typeof hideChartNoDataMessage && hideChartNoDataMessage(l), t._advState?.compareMode && t._advState?.mainDateRange && t._advState?.compareDateRange) { d = Array.isArray(t._advState.mainDateRange) && 2 === t._advState.mainDateRange.length ? t._advState.mainDateRange.map(e => e instanceof Date ? e : new Date(e)) : null, s = Array.isArray(t._advState.compareDateRange) && 2 === t._advState.compareDateRange.length ? t._advState.compareDateRange.map(e => e instanceof Date ? e : new Date(e)) : null; if (d && s && "function" == typeof window.updateAnglesChartsWithComparison) return void window.updateAnglesChartsWithComparison(t, d, s) } advInitChartV2(l, advBuildApiUrl(t, { mode: "your_company", chartType: e, service: "windsor", dateRange: a, platform: o, adsStatus: n })) } } } function updateDisplay(e, a, t) { e && 2 === e.length && (a.textContent = e[0].toLocaleDateString("en-US", a = { year: "numeric", month: "2-digit", day: "2-digit" }), t.textContent = e[1].toLocaleDateString("en-US", a)) } function isDateInRange(e, a, t) { return !!(e && a && t) && (e = new Date(e.getFullYear(), e.getMonth(), e.getDate()), a = new Date(a.getFullYear(), a.getMonth(), a.getDate()), t = new Date(t.getFullYear(), t.getMonth(), t.getDate()), a <= e) && e <= t } function showNoHistoricalDataMessage(e) {
    if (e) {
        var a, t = e.closest(".tab-content-flex") || e.closest(".card-block-wrap") || e.closest(".w-tab-pane"); if (t) {
            let e = t.querySelector(".adv-no-historical-data-message"); e ? e.style.display = "block" : ((e = document.createElement("div")).className = "adv-no-historical-data-message", e.style.cssText = "padding: 12px 16px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; margin-bottom: 16px; color: #856404; font-size: 14px; line-height: 1.5;", e.innerHTML = `
        <strong>Note:</strong> Historical data collection started recently. Chart shows current active ads count distributed evenly across the date range.
    `, (a = t.querySelector(".chart-canvas")) && a.parentNode ? a.parentNode.insertBefore(e, a) : t.insertBefore(e, t.firstChild))
        } else console.warn("[ADV] showNoHistoricalDataMessage: No parent container found", e)
    }
} function hideNoHistoricalDataMessage(e) { e && (e = e.closest(".card-block-wrap") || e.closest(".tab-content-flex") || e.closest(".w-tab-pane") || e.parentElement) && (e = e.querySelector(".adv-no-historical-data-message")) && (e.style.display = "none") } function customHighlight(e, r, n) { let o = ADV_MAIN_COLOR; if ("highlight-compare" === n && (o = ADV_COMPARE_COLOR), e.calendarContainer.querySelectorAll("." + n).forEach(e => { e.classList.remove(n), "highlight-compare" === n && (e.style.background = "", e.style.borderColor = "", e.style.color = "") }), r && 2 === r.length) { let [a, t] = r; e.days.childNodes.forEach(e => { e.dateObj && isDateInRange(e.dateObj, a, t) && (e.classList.add(n), "highlight-compare" === n) && (e.style.background = o + " !important", e.style.borderColor = o + " !important", e.style.color = "white") }) } } !function () {
    function s(e, a, t, r) { let n = t, o = r; var s; t.channels && 0 !== t.channels.length || ("creator" === (s = advDetectServiceFromResponse(t)) ? n = advTransformCreatorDataToChart(t) : "windsor" === s && (n = advTransformAnglesToLineChartFormat(t))), r.channels && 0 !== r.channels.length || ("creator" === (s = advDetectServiceFromResponse(r)) ? o = advTransformCreatorDataToChart(r) : "windsor" === s && (o = advTransformAnglesToLineChartFormat(r))), e._advTableState || (e._advTableState = {}), e._advTableState.comparisonMode = !0, e._advTableState.mainData = n, e._advTableState.compareData = o, e._advTableState.currentView = "main", "function" == typeof window.advRenderComparisonTable ? window.advRenderComparisonTable(e, "main") : console.error("[ADV] advRenderComparisonTable function not found") } function l(V, e, U) {
        var a = ("undefined" != typeof API_BASE_URL ? API_BASE_URL : "") + "api/org/competitor-detail", a = "function" == typeof msGetData ? msGetData(a + "?type=company") : a + "?type=company"; Promise.all([fetch(e).then(e => e.json()), fetch(a).then(e => e.json()).catch(e => (console.warn("[ADV] Failed to fetch company detail:", e), { data: { json: {} } }))]).then(([O, t]) => {
            let P = O.channels || []; if (P.length) {
                let N = advGetBaseMetricsConfig(O); if (N.length) {
                    let L = t?.data?.json?.settings || {}, T = L?.targets?.roas && 0 < Object.keys(L.targets.roas).length && Object.values(L.targets.roas).some(e => e && 0 < parseFloat(e)), k = O.helperText || {}, e = (Array.isArray(k) && (k = {}), V.querySelector(".adv-channel-table-wrapper") || V.querySelector(".table-render") || V), x = e.querySelector(".adv-channel-table") || ((t = document.createElement("table")).className = "adv-channel-table", e.appendChild(t), t); x.innerHTML = ""; t = document.createElement("thead"); let n = document.createElement("tr"); var o = document.createElement("th"), o = (n.appendChild(o), U?.classList?.contains("section-offers")), s = U?.classList?.contains("section-usecases"); let a = o ? "Offer" : s ? "Use Case" : "Format"; o || s || !O.meta?.dimensionLabel || (a = O.meta.dimensionLabel); var o = document.createElement("th"), s = (o.className = "adv-sortable-header", o.setAttribute("data-sort-column", "name"), o.setAttribute("data-sort-type", "text"), o.setAttribute("data-original-text", a), o.style.cursor = "pointer", o.title = "Click to sort alphabetically", document.createElement("span")), l = (s.className = "adv-sort-text", s.textContent = a, document.createElement("span")); l.className = "adv-sort-arrow", l.style.display = "inline-block", l.style.width = "16px", l.style.marginLeft = "4px", l.style.textAlign = "left", l.style.visibility = "hidden", o.appendChild(s), o.appendChild(l), n.appendChild(o), N.forEach(e => { var a = document.createElement("th"), t = e.id.toLowerCase(), r = ("adslaunched" === t ? a.className = "adv-metric-center adv-sortable-header" : "decimal" === e.format || "percent" === e.format || "number" === e.format ? a.className = "adv-metric-right adv-sortable-header" : a.className = "adv-sortable-header", a.setAttribute("data-sort-column", e.id), a.setAttribute("data-sort-type", "number"), a.setAttribute("data-original-text", e.label), a.style.cursor = "pointer", a.title = "Click to sort (High to Low / Low to High)", document.createElement("span")), e = (r.className = "adv-sort-text", r.textContent = e.label, document.createElement("span")); e.className = "adv-sort-arrow", e.style.display = "inline-block", e.style.width = "16px", e.style.marginLeft = "4px", e.style.textAlign = "left", e.style.visibility = "hidden", a.appendChild(r), a.appendChild(e), n.appendChild(a), "roas" === t && T && ((r = document.createElement("th")).className = "adv-metric-right", r.textContent = "ROAS vs Target", n.appendChild(r)) }), t.appendChild(n), x.appendChild(t); let r = t.querySelectorAll(".adv-sortable-header"), E = (r.forEach(e => { e.addEventListener("click", function () { var e = this.getAttribute("data-sort-column"), a = this.getAttribute("data-sort-type"), e = (V._advSortState || (V._advSortState = { column: null, direction: null }), V._advSortState.column === e ? V._advSortState.direction = "desc" === V._advSortState.direction ? "asc" : "desc" : (V._advSortState.column = e, V._advSortState.direction = "number" === a ? "desc" : "asc"), r.forEach(e => { e.classList.remove("adv-sort-asc", "adv-sort-desc"); e = e.querySelector(".adv-sort-arrow"); e && (e.textContent = "", e.style.visibility = "hidden") }), this.querySelector(".adv-sort-arrow")), a = (e && (e.textContent = "desc" === V._advSortState.direction ? "↓" : "↑", e.style.visibility = "visible"), this.classList.add("desc" === V._advSortState.direction ? "adv-sort-desc" : "adv-sort-asc"), V._advTableState || {}), e = a.channels || [], t = a.defaultIndexes || [], e = e[0]?.companies?.[0]?.id || "your-company"; d(a.companyId || e, void 0 !== a.customIndexes ? a.customIndexes : a.idxs || t, a.selectedChannels || []) }) }), document.createElement("tbody")), M = (x.appendChild(E), O.dates || []), R = []; if (U._advState?.startDate && U._advState?.endDate) R = advFilterDateRange(M, U._advState.startDate, U._advState.endDate); else { let r = new Date(M[M.length - 1]), n = new Date(r), e = 6; s = U.querySelector(".date-range-dd-select"); s && (l = s.querySelector('[data-default="1"]')) && ("lastWeek" === (o = l.getAttribute("data-dropdown")) ? e = 6 : "lastMonth" === o ? e = 29 : "lastYear" === o && (e = 364)), n.setDate(n.getDate() - e), R = M.reduce((e, a, t) => { a = new Date(a); return a >= n && a <= r && e.push(t), e }, []) } let q = [], I = O.meta?.currency || "EUR"; V._advRebuildTable = function (e, a, t) { var r; V._advTableState && V._advTableState.comparisonMode ? (r = V._advTableState.currentView || "main", i(V, r)) : d(e, a, t) }; function d(o, e, a) {
                        let c = T, t = U._advState?.platform || "all"; var r = { facebook: "meta", google: "google", tiktok: "titok", influencer: "influencer" }[t = t && "all" !== t ? t : "meta"] || t, r = c && L?.targets?.roas?.[r] || null; let u = r ? parseFloat(r) : null, d = (V._advTableState = { companyId: o, customIndexes: e, selectedChannels: a, defaultIndexes: R, json: O, channels: P }, R); if (Array.isArray(e) && 0 < e.length) if (U._advState?.startDate && U._advState?.endDate) d = advFilterDateRange(M, U._advState.startDate, U._advState.endDate); else { let a = M.length - 1; 0 === (d = e.filter(e => 0 <= e && e <= a)).length && (d = R) } V._advTableState.idxs = d, V._advTableState.customIndexes = e, q = Array.isArray(a) ? a.slice() : []; let n = U._advState?.metric || null; if (!n) { let e = U.querySelector(".chart-canvas"), a = e?._advController; a && a._advMetric && (n = a._advMetric) } n = n || "revenue", 0 < P.length && P[0].companies && 0 < P[0].companies.length && P[0].companies[0], E.innerHTML = ""; let i = [], p = 0, v = 0, s = [...P].sort((e, a) => { e = (e.label || e.id || "").toLowerCase(), a = (a.label || a.id || "").toLowerCase(); return "other" === e ? 1 : "other" === a ? -1 : e.localeCompare(a) }), m = []; if (s.forEach((s, e) => { var a = s.companies || []; let l = a.find(e => e.id === o) || a[0]; if (l) { let o = {}; "before–after-proof" === s.id && (l.adsLaunched, l.adsLaunchedUnique, l.adsLaunched && l.adsLaunched.length, l.adsLaunchedUnique && l.adsLaunchedUnique.length, Object.keys(l).join(", ")), N.forEach(e => { var a, t, r = e.key, n = e.id.toLowerCase(), r = l[r]; "ctr" === n ? (t = advSumSubset(l.linkClicks, d), a = advSumSubset(l.impressions, d), o[e.id] = 0 < a ? t / a : 0) : "roas" === n ? (t = advSumSubset(l.revenue, d), a = advSumSubset(l.spend, d), t = 0 < (a = l.totalcost ? advSumSubset(l.totalcost, d) : a) ? t / a : 0, o[e.id] = t, u && 0 < u ? 0 < t ? (a = (t - u) / u * 100, o.roasVsTarget = a) : o.roasVsTarget = 0 == t ? -100 : null : o.roasVsTarget = null) : "revenueperad" === n ? (a = advSumSubset(l.revenue, d), t = advSumSubset(l.adsLaunchedUnique, d), o[e.id] = 0 < t ? a / t : 0) : "adslaunched" === n ? (t = advSumSubset(a = l.adsLaunchedUnique || l.adsLaunched || [], d), o[e.id] = t, "before–after-proof" === s.id && a.length) : o[e.id] = advSumSubset(r, d) }); var a = N.find(e => "adslaunched" === e.id.toLowerCase()), t = a ? o[a.id] : 0; if (a && 0 === t) v++; else { a = n ? n.toLowerCase() : ""; if (!("adslaunched" === a || "netlaunched" === a)) { t = N.find(e => "spend" === e.id.toLowerCase()), a = t ? o[t.id] : null; t && t.id; if (t && (!a || 0 === a)) return void v++ } p++; t = 0 < q.length && -1 !== q.indexOf(s.id); t && !i.includes(s.id) && i.push(s.id), m.push({ channel: s, ctx: o, checked: t }) } } }), V._advSortState || (V._advSortState = { column: null, direction: null }), V._advSortState && V._advSortState.column) { let o = V._advSortState.column, s = V._advSortState.direction || "desc"; o; m.sort((e, a) => { let t, r; var n; return "name" === o ? (t = (e.channel.label || e.channel.id || "").toLowerCase(), r = (a.channel.label || a.channel.id || "").toLowerCase(), "other" === t ? 1 : "other" === r ? -1 : (n = t.localeCompare(r), "asc" === s ? n : -n)) : (t = e.ctx[o] || 0, r = a.ctx[o] || 0, t = Number(t) || 0, r = Number(r) || 0, "desc" === s ? r - t : t - r) }) } m.forEach(e => {
                            var a = e.channel; let l = e.ctx; var e = e.checked, t = document.createElement("tr"); let d = `
                <td><input type="checkbox" class="adv-channel-checkbox"
                      data-adv-channel="${a.id}"
                      ${e ? "checked" : ""}></td>
              `, i = a.label || a.id; e = k[i]; let r = i; e && e.trim() && (a = e.replace(/"/g, "&quot;").replace(/'/g, "&#39;").replace(/\n/g, " "), r += ` <div tooltipster="top" class="info-tooltip-svg w-embed tooltipstered" title="${a}" style="display: inline-block; width: 16px; height: 16px; margin-left: 4px; vertical-align: middle; cursor: help;">
                                <svg fill="currentcolor" width="100%" height="100%" viewBox="-2 -2 24 24" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMinYMin" class="jam jam-info">
                                    <path d="M10 20C4.477 20 0 15.523 0 10S4.477 0 10 0s10 4.477 10 10-4.477 10-10 10zm0-2a8 8 0 1 0 0-16 8 8 0 0 0 0 16zm0-10a1 1 0 0 1 1 1v5a1 1 0 0 1-2 0V9a1 1 0 0 1 1-1zm0-1a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"></path>
                                </svg>
                            </div>`), d += `<td>${r}</td>`, N.forEach(a => {
                                var t = advFormatMetricValue(a, l[a.id] || 0, I), r = a.id.toLowerCase(); let e = ""; if ("adslaunched" === r ? e = "adv-metric-center" : "decimal" !== a.format && "percent" !== a.format && "number" !== a.format || (e = "adv-metric-right"), d += `<td${e ? ' class="' + e + '"' : ""}>${t}</td>`, "roas" === r && c) {
                                    var n, o, s, t = l.roasVsTarget, r = l[a.id] || 0; let e = ""; e = null != t ? (n = 0 <= (t = Math.round(t)) ? "+" : "-", o = Math.abs(t), s = 0 <= t ? "highlight-green" : "highlight-red", advFormatMetricValue(a, r, I), u && advFormatMetricValue(a, u, I), a = i || "Category", `<td class="adv-metric-right">
                                        <div data-tooltip="#benchmark-tooltip" 
                                             class="target-text ${s}" 
                                             aria-expanded="false"
                                             data-actual-roas="${r}"
                                             data-target-roas="${u || ""}"
                                             data-category="${a}"
                                             data-percentage="${t}">${n} ${o}%</div>
                                    </td>`) : '<td class="adv-metric-right">--</td>', d += e
                                }
                            }), t.innerHTML = d, E.appendChild(t)
                        }), console.log("[ADV DEBUG] buildRows complete. Rows added: " + p + ", rows skipped: " + v + ", total channels processed: " + s.length), "undefined" != typeof tippy ? E.querySelectorAll(".target-text[data-tooltip]").forEach(e => {
                            e._tippy && e._tippy.destroy(), e.addEventListener("click", function (e) { e.stopPropagation() }), tippy(e, {
                                content(e) {
                                    var a = parseFloat(e.getAttribute("data-actual-roas")) || 0, t = parseFloat(e.getAttribute("data-target-roas")) || 0; let r = e.getAttribute("data-category") || "Category"; var e = parseFloat(e.getAttribute("data-percentage")) || 0, a = (r = r.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#39;"), 0 < a ? a.toFixed(2) : "0.00"), t = 0 < t ? t.toFixed(2) : "--", n = 0 <= e ? "highlight-green" : "highlight-red", o = 0 <= e ? "+" : "-", s = Math.abs(Math.round(e)); let l = ""; return `
                                        <div class="benchmark-tooltip">
                                            <div class="card-title">
                                                <h4 class="heading-tooltip">Benchmark</h4>
                                                <div class="subhead-regular">${l = 0 <= e ? `You're above your benchmark by ${s}%.` : `You're below your benchmark by ${s}%. You may need to change strategy or reduce budget.`}</div>
                                            </div>
                                            <div id="plGrowth" class="benchmark-table">
                                                <div class="benchmark-row table-header">
                                                    <div class="benchmark-table-label first-col">KPI</div>
                                                    <div class="benchmark-table-label">Current</div>
                                                    <div class="benchmark-table-label">Target</div>
                                                </div>
                                                <div class="benchmark-table-content">
                                                    <div class="benchmark-row">
                                                        <div class="benchmark-kpi">
                                                            <div class="benchmark-table-text first-col">ROAS (1d)</div>
                                                            <div class="target-text ${n}" aria-expanded="false">${o} ${s}%</div>
                                                        </div>
                                                        <div class="benchmark-table-text">${a}</div>
                                                        <div class="benchmark-table-text">${t}</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    `}, allowHTML: !0, interactive: !0, trigger: "click", placement: "top-end", arrow: !0, appendTo: document.body, onShow(e) { tippy.hideAll({ exclude: e }) }
                            })
                        }) : "function" == typeof initializeBenchmarkTooltips && initializeBenchmarkTooltips(); let l = {}, h = {}, f = {}; O._totalSpendUnique, O._totalRevenueUnique; r = n ? n.toLowerCase() : ""; let y = "adslaunched" === r || "netlaunched" === r; N.forEach(r => { let n = r.id.toLowerCase(); if (l[r.id] = 0, h[r.id] = 0, f[r.id] = 0, "roas" === n || "ctr" === n) l[r.id] = null, h[r.id] = null, f[r.id] = null; else if ("spend" === n) { let a = 0; s.forEach(e => { var e = e.companies || [], e = e.find(e => e.id === o) || e[0]; e && (e = advSumSubset(e[r.key], d), y || 0 < e) && (l[r.id] += e, h[r.id] += e, a++) }), f[r.id] = l[r.id] } else if ("revenue" === n) { let t = 0; s.forEach(e => { var a, e = e.companies || [], e = e.find(e => e.id === o) || e[0]; e && (a = (a = N.find(e => "spend" === e.id.toLowerCase())) ? advSumSubset(e[a.key], d) : 0, e = advSumSubset(e[r.key], d), y || 0 < a) && (h[r.id] += e, l[r.id] += e, t++) }), f[r.id] = l[r.id] } else { let t = 0; s.forEach(e => { e = e.companies || [], e = e.find(e => e.id === o) || e[0]; if (e) { if (!y) { var a = N.find(e => "spend" === e.id.toLowerCase()); if (a) if (0 === advSumSubset(e[a.key], d)) return } "revenueperad" !== n && ("adslaunched" === n ? l[r.id] += advSumSubset(e.adsLaunchedUnique, d) : (a = e[r.key], l[r.id] += advSumSubset(a, d)), t++) } }), n } }); var e = N.find(e => "adslaunched" === e.id.toLowerCase())?.id || "AdsLaunched", a = N.find(e => "revenue" === e.id.toLowerCase())?.id || "Revenue", r = N.find(e => "revenueperad" === e.id.toLowerCase())?.id || "RevenuePerAd", g = l[e] || 0, S = l[e] || 0, e = (O.meta?.chartType, null !== g && 0 < g ? (l[e + "_unique"] = g, l[e + "_total"] = S, l[e + "_formatted"] = `
                            <div class="adv-unique-ads-total" title="${g} unique ads">
                                <span class="adv-unique-count">${g}</span>
                            </div>
                        `) : l[e + "_formatted"] = S.toString(), f[a] || 0), C = h[a] || 0, e = null !== g && 0 < g ? e / g : 0, g = 0 < S ? C / S : 0, C = (l[r] = e, f[r] = e, h[r] = g, N.find(e => "roas" === e.id.toLowerCase())?.id || "ROAS"), S = f[a] || 0, e = f[N.find(e => "spend" === e.id.toLowerCase())?.id || "Spend"] || 0, r = (l[C] = 0 < e ? S / e : 0, f[C] = l[C], N.find(e => "ctr" === e.id.toLowerCase())?.id || "CTR"); let b = 0, _ = 0; s.forEach(e => { e = e.companies || [], e = e.find(e => e.id === o) || e[0]; if (e) { if (!y) { var a = N.find(e => "spend" === e.id.toLowerCase()); if (a) if (0 === advSumSubset(e[a.key], d)) return } a = advSumSubset(e.linkClicks, d), e = advSumSubset(e.impressions, d); 0 < e && (b += a, _ += e) } }), l[r] = 0 < _ ? b / _ : 0, f[r] = l[r]; g = document.createElement("tr"); g.className = "adv-total-row"; let D = '<td colspan="2" class="adv-total-label"><strong>Total</strong></td>', w = (N.forEach(e => { var a = e.id.toLowerCase(), t = l[e.id]; let r, n = (r = null === t ? "--" : "roas" === a || "ctr" === a ? advFormatMetricValue(e, t, I) : "adslaunched" === a ? l[e.id + "_formatted"] || t.toString() : "spend" === a || "revenue" === a || "revenueperad" === a ? advFormatMetricValue(e, f[e.id], I) : advFormatMetricValue(e, t, I), ""); "adslaunched" === a ? n = "adv-metric-center" : "decimal" !== e.format && "percent" !== e.format && "number" !== e.format || (n = "adv-metric-right"), D += `<td${n ? ' class="' + n + '"' : ""}><strong>${r}</strong></td>`, "roas" === a && c && (D += '<td class="adv-metric-right"><strong>--</strong></td>') }), g.innerHTML = D, E.appendChild(g), (V.closest(".tab-content-flex") ? V.closest(".tab-content-flex") : V.closest(".w-tab-pane") || V.closest(".card-block-wrap")).querySelector(".chart-canvas")), A = w?._advController; A && A.setChannels(i), "undefined" != typeof jQuery && jQuery.fn.tooltipster && (jQuery(x).find("[tooltipster]").each(function () { jQuery(this).data("tooltipster") && jQuery(this).tooltipster("destroy") }), 0 < (a = jQuery(x).find("[tooltipster]")).length) && a.tooltipster({ theme: "tooltipster-borderless", animation: "fade", delay: 200, maxWidth: 300, position: "top" })
                    } d(P[0].companies?.[0]?.id || "your-company", R, [])
                } else console.warn("[ADV] No base metrics in JSON:", e)
            } else console.warn("[ADV] No channels in JSON:", e)
        }).catch(e => { console.error("[ADV] Error in renderSingleTable:", e) })
    } function i(b, _) {
        if (b) if (b._advTableState) {
            var D = b.closest(".card-block-wrap") || document, w = b._advTableState.mainData, A = b._advTableState.compareData; let e = ADV_MAIN_COLOR; if ((w.yourCompany?.color || w.channels && 0 < w.channels.length && (w.channels[0]?.companies?.find(e => "your-company" === e.id))?.color) && (e = ADV_MAIN_COLOR), w && A) {
                b._advTableState.currentView = _; var L = b.querySelector(".adv-channel-table-wrapper") || b.querySelector(".table-render") || b; let y = L.querySelector(".adv-channel-table"), g = (y || ((y = document.createElement("table")).className = "adv-channel-table", L.appendChild(y)), y.innerHTML = "", w.channels || []), S = A.channels || []; L = [...new Set([...g.map(e => e.id), ...S.map(e => e.id)])]; let C = advGetBaseMetricsConfig(w); if (C.length) {
                    let o = w.helperText || A.helperText || {}; Array.isArray(o) && (o = {}); var T = document.createElement("thead"); let r = document.createElement("tr"); var k = document.createElement("th"), k = (r.appendChild(k), D?.classList?.contains("section-offers")), x = D?.classList?.contains("section-usecases"), D = D?.classList?.contains("section-formats"); let e = k ? "Offer" : x ? "Use Case" : "Format", v = (k || x || !w.meta?.dimensionLabel || (e = w.meta.dimensionLabel), D || k || x); D = document.createElement("th"), k = (D.textContent = e, D.className = "adv-sortable-header", D.setAttribute("data-sort-column", "name"), D.setAttribute("data-sort-type", "text"), document.createElement("span")), x = (k.textContent = e, document.createElement("span")); x.className = "adv-sort-arrow", x.style.visibility = "hidden", x.style.display = "inline-block", x.style.width = "16px", x.style.marginLeft = "4px", x.style.textAlign = "left", D.innerHTML = "", D.appendChild(k), D.appendChild(x), r.appendChild(D), C.forEach(e => { var a = document.createElement("th"), t = (a.textContent = e.label, e.id.toLowerCase()), t = ("adslaunched" === t ? a.className = "adv-metric-center adv-sortable-header" : "decimal" === e.format || "percent" === e.format || "number" === e.format ? a.className = "adv-metric-right adv-sortable-header" : a.className = "adv-sortable-header", a.setAttribute("data-sort-column", e.id), a.setAttribute("data-sort-type", "number"), document.createElement("span")), e = (t.textContent = e.label, document.createElement("span")); e.className = "adv-sort-arrow", e.style.visibility = "hidden", e.style.display = "inline-block", e.style.width = "16px", e.style.marginLeft = "4px", e.style.textAlign = "left", a.innerHTML = "", a.appendChild(t), a.appendChild(e), r.appendChild(a) }), T.appendChild(r), y.appendChild(T); let a = document.createElement("tbody"), t = L, l = []; if (t.forEach((a, e) => {
                        let u = g.find(e => e.id === a), p = S.find(e => e.id === a); if (u || p) {
                            let d = document.createElement("tr"); var t = document.createElement("td"), r = document.createElement("input"), r = (r.type = "checkbox", r.className = "adv-channel-checkbox", r.dataset.advChannel = a, r.checked = !1, t.appendChild(r), d.appendChild(t), document.createElement("td")), t = (u || p).label || a, n = o[t]; n && n.trim() ? (n = n.replace(/"/g, "&quot;").replace(/'/g, "&#39;").replace(/\n/g, " "), r.innerHTML = t + ` <div tooltipster="top" class="info-tooltip-svg w-embed tooltipstered" title="${n}" style="display: inline-block; width: 16px; height: 16px; margin-left: 4px; vertical-align: middle; cursor: help;">
                    <svg fill="currentcolor" width="100%" height="100%" viewBox="-2 -2 24 24" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMinYMin" class="jam jam-info">
                        <path d="M10 20C4.477 20 0 15.523 0 10S4.477 0 10 0s10 4.477 10 10-4.477 10-10 10zm0-2a8 8 0 1 0 0-16 8 8 0 0 0 0 16zm0-10a1 1 0 0 1 1 1v5a1 1 0 0 1-2 0V9a1 1 0 0 1 1-1zm0-1a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"></path>
                    </svg>
                </div>`) : r.textContent = t, d.appendChild(r); let i = ADV_MAIN_COLOR, c = ADV_COMPARE_COLOR; C.forEach((e, a) => { var t = e.id.toLowerCase(); let r, n; n = "roas" === t ? (r = M(u), M(p)) : "ctr" === t ? (r = R(u), R(p)) : (r = q(u, e.key), q(p, e.key)); t = null !== r && void 0 !== r ? advFormatMetricValue(e, r) : "--", e = null !== n && void 0 !== n ? advFormatMetricValue(e, n) : "--"; let o = null; v && null !== r && void 0 !== r && null !== n && void 0 !== n && 0 !== n && (o = I(r, n)); var s = document.createElement("td"), l = (s.className = "adv-metric-center", document.createElement("span")), t = (l.textContent = t, l.className = "adv-comparison-primary", l.style.setProperty("--primary-color", i), document.createElement("span")); t.textContent = e, t.className = "adv-comparison-compare", t.style.setProperty("--compare-color", c), s.appendChild(l), s.appendChild(t), v && null !== o && (e = document.createElement("span"), l = 0 < o, e.textContent = (l ? "↑" : "↓") + ` ${Math.abs(o).toFixed(1)}%`, e.className = l ? "adv-comparison-percentage adv-comparison-percentage--increase" : "adv-comparison-percentage adv-comparison-percentage--decrease", s.appendChild(e)), d.appendChild(s) }), l.push({ tr: d, channelId: a, channelLabel: t, mainChannel: u, compareChannel: p, values: {} }), C.forEach((e, a) => { var t = e.id.toLowerCase(); let r, n; n = "roas" === t ? (r = M(u), M(p)) : "ctr" === t ? (r = R(u), R(p)) : (r = q(u, e.key), q(p, e.key)), l[l.length - 1].values[e.id] = null !== r && void 0 !== r ? r : 0 })
                        }
                    }), b._advSortState && b._advSortState.column) { let n = b._advSortState.column, o = b._advSortState.direction || "desc", s = "name" === n ? "text" : "number"; l.sort((e, a) => { let t, r; return r = "name" === n ? (t = e.channelLabel || "", a.channelLabel || "") : (t = e.values[n] || 0, a.values[n] || 0), "text" == s ? "asc" === o ? t.localeCompare(r) : r.localeCompare(t) : "asc" === o ? t - r : r - t }) } if (l.forEach(e => { a.appendChild(e.tr) }), b._advSortState && b._advSortState.column) { let e = T.querySelectorAll(".adv-sortable-header"); e.forEach(e => { e.classList.remove("adv-sort-asc", "adv-sort-desc"); var a = e.querySelector(".adv-sort-arrow"); a && (e.getAttribute("data-sort-column") === b._advSortState.column ? (a.textContent = "desc" === b._advSortState.direction ? "↓" : "↑", a.style.visibility = "visible", e.classList.add("desc" === b._advSortState.direction ? "adv-sort-desc" : "adv-sort-asc")) : (a.textContent = "", a.style.visibility = "hidden")) }) } let s = document.createElement("tr"); s.className = "adv-total-row"; k = document.createElement("td"), x = (k.colSpan = 2, k.className = "adv-total-label", document.createElement("strong")); x.textContent = "Total", k.appendChild(x), s.appendChild(k); let d = {}, i = {}; D = C.some(e => "roas" === e.id.toLowerCase()); let n = 0, c = 0, u = 0, p = 0, m = (D && t.forEach(a => { var e = g.find(e => e.id === a), t = S.find(e => e.id === a); e && e.companies && e.companies.forEach(e => { e.revenue && Array.isArray(e.revenue) && (n += e.revenue.reduce((e, a) => e + (a || 0), 0)); e = e.totalcost || e.spend; e && Array.isArray(e) && (c += e.reduce((e, a) => e + (a || 0), 0)) }), t && t.companies && t.companies.forEach(e => { e.revenue && Array.isArray(e.revenue) && (u += e.revenue.reduce((e, a) => e + (a || 0), 0)); e = e.totalcost || e.spend; e && Array.isArray(e) && (p += e.reduce((e, a) => e + (a || 0), 0)) }) }), C.forEach(l => { var e = l.id.toLowerCase(); if ("roas" === e) d[l.key] = 0 < c ? n / c : null, i[l.key] = 0 < p ? u / p : null; else if ("ctr" === e) { let r = 0, n = 0, o = 0, s = 0; t.forEach(a => { var e = g.find(e => e.id === a), t = S.find(e => e.id === a); e && e.companies && e.companies.length && e.companies.forEach(t => { t.linkClicks && Array.isArray(t.linkClicks) && t.impressions && Array.isArray(t.impressions) && t.linkClicks.forEach((e, a) => { e = Number(e) || 0, a = Number(t.impressions[a]) || 0; 0 < a && (r += e, n += a) }) }), t && t.companies && t.companies.length && t.companies.forEach(t => { t.linkClicks && Array.isArray(t.linkClicks) && t.impressions && Array.isArray(t.impressions) && t.linkClicks.forEach((e, a) => { e = Number(e) || 0, a = Number(t.impressions[a]) || 0; 0 < a && (o += e, s += a) }) }) }), d[l.key] = 0 < n ? r / n : null, i[l.key] = 0 < s ? o / s : null } else d[l.key] = 0, i[l.key] = 0, t.forEach(a => { var e = g.find(e => e.id === a), t = S.find(e => e.id === a), e = q(e, l.key), t = q(t, l.key); null != e && (d[l.key] += e), null != t && (i[l.key] += t) }) }), ADV_MAIN_COLOR), h = ADV_COMPARE_COLOR, f = (C.forEach(e => { var a = d[e.key] || 0, t = i[e.key] || 0, r = null !== a && 0 !== a ? advFormatMetricValue(e, a) : "--", e = null !== t && 0 !== t ? advFormatMetricValue(e, t) : "--"; let n = null; v && null !== a && null !== t && 0 !== t && (n = I(a, t)); var a = document.createElement("td"), t = (a.className = "adv-metric-center", document.createElement("span")), r = (t.textContent = r, t.className = "adv-comparison-primary", t.style.setProperty("--primary-color", m), document.createElement("span")); r.textContent = e, r.className = "adv-comparison-compare", r.style.setProperty("--compare-color", h), a.appendChild(t), a.appendChild(r), v && null !== n && (e = document.createElement("span"), t = 0 < n, e.textContent = (t ? "↑" : "↓") + ` ${Math.abs(n).toFixed(1)}%`, e.className = t ? "adv-comparison-percentage adv-comparison-percentage--increase" : "adv-comparison-percentage adv-comparison-percentage--decrease", a.appendChild(e)), s.appendChild(a) }), a.appendChild(s), y.appendChild(a), T.querySelectorAll(".adv-sortable-header")); f.forEach(e => { e.addEventListener("click", function () { var e = this.getAttribute("data-sort-column"), a = this.getAttribute("data-sort-type"), e = (b._advSortState || (b._advSortState = { column: null, direction: null }), b._advSortState.column === e ? b._advSortState.direction = "desc" === b._advSortState.direction ? "asc" : "desc" : (b._advSortState.column = e, b._advSortState.direction = "number" === a ? "desc" : "asc"), f.forEach(e => { e.classList.remove("adv-sort-asc", "adv-sort-desc"); e = e.querySelector(".adv-sort-arrow"); e && (e.textContent = "", e.style.visibility = "hidden") }), this.querySelector(".adv-sort-arrow")); e && (e.textContent = "desc" === b._advSortState.direction ? "↓" : "↑", e.style.visibility = "visible"), this.classList.add("desc" === b._advSortState.direction ? "adv-sort-desc" : "adv-sort-asc"), window.advRenderComparisonTable(b, _) }) }), "undefined" != typeof jQuery && jQuery.fn.tooltipster && (jQuery(y).find("[tooltipster]").each(function () { jQuery(this).data("tooltipster") && jQuery(this).tooltipster("destroy") }), 0 < (L = jQuery(y).find("[tooltipster]")).length) && L.tooltipster({ theme: "tooltipster-borderless", animation: "fade", delay: 200, maxWidth: 300, position: "top" }), E(b, y)
                } else console.warn("[ADV] No base metrics in JSON")
            } else console.error("[ADV] advRenderComparisonTable: mainJson or compareJson is missing", { mainJson: !!w, compareJson: !!A })
        } else console.error("[ADV] advRenderComparisonTable: _advTableState is missing on wrapper", b); else console.error("[ADV] advRenderComparisonTable: wrapper is missing")
    } function E(a, o) { o._advComparisonChangeHandler && (o.removeEventListener("change", o._advComparisonChangeHandler, !0), o._advComparisonChangeHandler = null), o._advComparisonClickHandler && (o.removeEventListener("click", o._advComparisonClickHandler, !0), o._advComparisonClickHandler = null); let s = a.closest(".card-block-wrap"); if (s) { var t = a.closest(".tab-content-flex"); let e = t ? t.querySelector(".chart-canvas") : null; if (e && e._advComparisonMode || a._advTableState && a._advTableState.comparisonMode) { let n = e && e._advComparisonSetChannels && "function" == typeof e._advComparisonSetChannels ? e._advComparisonSetChannels : null; if (n) { let r = s._advState?.channels || []; o.querySelectorAll(".adv-channel-checkbox").forEach(e => { var a = e.dataset.advChannel; e.checked = r.includes(a) }); t = e => { let a = e.target.closest(".adv-channel-checkbox"); var t; a && (e.stopPropagation(), e = a.dataset.advChannel) && (t = o.querySelectorAll(".adv-channel-checkbox"), r = a.checked ? (t.forEach(e => { e !== a && (e.checked = !1) }), [e]) : [], s._advState || (s._advState = {}), s._advState.channels = r.slice(), n(r)) }, t = (o._advComparisonChangeHandler = t, o.addEventListener("change", t, !0), e => { var a = e.target.closest("tr"); !a || a.classList.contains("adv-total-row") || !(a = a.querySelector(".adv-channel-checkbox")) || e.target.closest(".adv-channel-checkbox") || e.target.closest(".target-text") || (e.stopPropagation(), a.checked = !a.checked, e = new Event("change", { bubbles: !0 }), a.dispatchEvent(e)) }); o._advComparisonClickHandler = t, o.addEventListener("click", t, !0) } else setTimeout(() => { var e = a.closest(".tab-content-flex"), e = e ? e.querySelector(".chart-canvas") : null; e && e._advComparisonSetChannels && "function" == typeof e._advComparisonSetChannels && E(a, o) }, 200) } } } function M(e) { if (!e || !e.companies || !e.companies.length) return null; let t = 0, r = 0, n = !1; return e.companies.forEach(e => { e.revenue && Array.isArray(e.revenue) && (a = e.revenue.reduce((e, a) => e + (a || 0), 0), t += a, n = !0); var a = e.totalcost || e.spend; a && Array.isArray(a) && (e = a.reduce((e, a) => e + (a || 0), 0), r += e) }), n && 0 < r ? t / r : null } function R(e) { if (!e || !e.companies || !e.companies.length) return null; let r = 0, n = 0, o = !1; return e.companies.forEach(t => { t.linkClicks && Array.isArray(t.linkClicks) && t.impressions && Array.isArray(t.impressions) && t.linkClicks.forEach((e, a) => { e = Number(e) || 0, a = Number(t.impressions[a]) || 0; 0 < a && (r += e, n += a, o = !0) }) }), o && 0 < n ? r / n : null } function q(e, t) { if (!e || !e.companies || !e.companies.length) return null; let r = 0, n = !1; return e.companies.forEach(e => { var a, e = e[t]; null != e && (Array.isArray(e) ? ((0 < (a = e.reduce((e, a) => e + (a || 0), 0)) || 0 < e.length) && (n = !0), r += a) : (0 < (a = e || 0) && (n = !0), r += a)) }), n ? r : null } function I(e, a) { return a && 0 !== a ? (e - a) / a * 100 : 0 } window.advRenderComparisonTable = i, window.connectComparisonTableHandlers = E, window.advInitTable = function (r, a, e = null, n = null, o = null) { if (r) { let t = r.closest(".card-block-wrap") || document; if (e || n && o) return n && o ? void s(r, t, n, o) : void Promise.all([fetch(a).then(e => e.json()), fetch(e).then(e => e.json())]).then(([e, a]) => { s(r, t, e, a) }).catch(e => { console.error("[ADV] Table comparison fetch error", e), l(r, a, t) }); a ? l(r, a, t) : console.warn("[ADV] advInitTable: Missing jsonUrl for single table mode") } else console.warn("[ADV] advInitTable: Missing wrapper") }
}(), function () {
    function s(S, C, b) {
        fetch(C).then(e => e.json()).then(c => {
            let u = c.companies || [], p = c.angles || []; var v = c.dates || []; let m = c.helperText || {}; if (Array.isArray(m) && (m = {}), u.length && p.length) {
                let e = S.querySelector(".adv-channel-table-wrapper") || S.querySelector(".table-render") || S, a = e.querySelector(".adv-channel-table") || ((h = document.createElement("table")).className = "adv-channel-table", e.appendChild(h), h); a.innerHTML = ""; var h = document.createElement("thead"); let t = document.createElement("tr"); var f = b?.classList?.contains("section-offers"), y = b?.classList?.contains("section-usecases"); let r = f ? "Offer" : y ? "Use Case" : "Format"; f || y || !c.meta?.dimensionLabel || (r = c.meta.dimensionLabel); f = document.createElement("th"), y = (f.textContent = r || "Category", f.className = "adv-creator-category-header", t.appendChild(f), document.createElement("th")), c = (y.textContent = "TOTAL", y.className = "adv-metric-center adv-creator-total-header", t.appendChild(y), b._advState?.adsStatus || (C.includes("ads_status=active") ? "active" : "launched")); let n = "active" === c ? "Ads Active" : "Ads Launched", l = (u.forEach(e => { var a = document.createElement("th"); a.textContent = e.name || "", a.className = "adv-metric-center adv-creator-company-header", a.title = n, e.color && (a.style.borderTop = "3px solid " + e.color), t.appendChild(a) }), h.appendChild(t), a.appendChild(h), document.createElement("tbody")), o = (a.appendChild(l), new Date(v[v.length - 1])), s = new Date(o), d = 6; f = b.querySelector(".date-range-dd-select"); f && (y = f.querySelector('[data-default="1"]')) && ("lastWeek" === (c = y.getAttribute("data-dropdown")) ? d = 6 : "lastMonth" === c ? d = 29 : "lastYear" === c && (d = 364)), s.setDate(s.getDate() - d); let i = v.reduce((e, a, t) => { a = new Date(a); return a >= s && a <= o && e.push(t), e }, []); function g(e) {
                    let s = Array.isArray(e) && e.length ? e : i; l.innerHTML = "", [...p].sort((e, a) => { e = e.toLowerCase(), a = a.toLowerCase(); return "other" === e ? 1 : "other" === a ? -1 : e.localeCompare(a) }).forEach(a => {
                        let r = document.createElement("tr"); var e = document.createElement("td"), t = (e.className = "adv-creator-category-cell", m[a]); t && t.trim() ? (t = t.replace(/"/g, "&quot;").replace(/'/g, "&#39;").replace(/\n/g, " "), e.innerHTML = a + ` <div tooltipster="top" class="info-tooltip-svg w-embed tooltipstered" title="${t}" style="display: inline-block; width: 16px; height: 16px; margin-left: 4px; vertical-align: middle; cursor: help;">
                                <svg fill="currentcolor" width="100%" height="100%" viewBox="-2 -2 24 24" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMinYMin" class="jam jam-info">
                                    <path d="M10 20C4.477 20 0 15.523 0 10S4.477 0 10 0s10 4.477 10 10-4.477 10-10 10zm0-2a8 8 0 1 0 0-16 8 8 0 0 0 0 16zm0-10a1 1 0 0 1 1 1v5a1 1 0 0 1-2 0V9a1 1 0 0 1 1-1zm0-1a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"></path>
                                </svg>
                            </div>`) : e.textContent = a, r.appendChild(e); let n = 0, o = []; u.forEach(e => { e = advSumSubset(e.adsLaunchedUniqueByAngle?.[a] || [], s); o.push(e), n += e }), 0 !== n && ((t = document.createElement("td")).className = "adv-metric-center adv-creator-total-cell", t.textContent = n.toLocaleString(), r.appendChild(t), u.forEach((e, a) => { var t = document.createElement("td"), a = (t.className = "adv-metric-center adv-creator-company-cell", o[a]); t.textContent = a.toLocaleString(), r.appendChild(t) }), l.appendChild(r))
                    }), "undefined" != typeof jQuery && jQuery.fn.tooltipster && (jQuery(a).find("[tooltipster]").each(function () { jQuery(this).data("tooltipster") && jQuery(this).tooltipster("destroy") }), 0 < (e = jQuery(a).find("[tooltipster]")).length) && e.tooltipster({ theme: "tooltipster-borderless", animation: "fade", delay: 200, maxWidth: 300, position: "top" })
                } g(i), S._advRebuildTable = function (e) { g(e) }
            } else console.warn("[ADV] No companies or angles in creator data:", C)
        }).catch(e => { console.error("[ADV] Creator table init failed:", e) })
    } window.advInitTableCreator = function (r, n, e = null, a = null, o = null) { if (r) { let t = r.closest(".card-block-wrap") || document; if (e || a && o) return a && o ? (a = a, o = o, r._advTableState || (r._advTableState = {}), r._advTableState.comparisonMode = !0, r._advTableState.mainData = a, r._advTableState.compareData = o, r._advTableState.currentView = "main", void ("function" == typeof window.advRenderComparisonTable ? window.advRenderComparisonTable(r, "main") : n && s(r, n, t))) : void Promise.all([fetch(n).then(e => e.json()), fetch(e).then(e => e.json())]).then(([e, a]) => { r._advTableState || (r._advTableState = {}), r._advTableState.comparisonMode = !0, r._advTableState.mainData = e, r._advTableState.compareData = a, r._advTableState.currentView = "main", "function" == typeof window.advRenderComparisonTable ? window.advRenderComparisonTable(r, "main") : s(r, n, t) }).catch(e => { console.error("[ADV] Creator table comparison fetch error", e), n && s(r, n, t) }); n ? s(r, n, t) : console.warn("[ADV] advInitTableCreator: Missing jsonUrl for single table mode") } }
}(), document.addEventListener("click", a => { var t = a.target.closest(".company-dd-link-select [data-dropdown]"); if (t) advApplyCompanySelection(t), window.$ && $(t.closest(".dropdown,.w-dropdown")).triggerHandler("w-close.w-dropdown"); else { t = a.target.closest(".chart-metric-dd-select [data-dropdown]"); if (t) advApplyMetricSelection(t), window.$ && $(t.closest(".dropdown,.w-dropdown")).triggerHandler("w-close.w-dropdown"); else { t = a.target.closest(".chart-switch-mode-btn.ads-mode a"); if (t) { a.preventDefault(); a = t.closest(".card-block-wrap"); if (a) { let e = "launched"; t.classList.contains("btn-ad-active") ? e = "active" : t.classList.contains("btn-ad-launched") && (e = "launched"); var r = t.closest(".chart-switch-mode-btn.ads-mode"); r && (r.querySelectorAll("a").forEach(e => { e.classList.remove("is-active") }), t.classList.add("is-active")), advApplyAdsStatusToBlock(a, e) } } } } }), function () { function i(e) { e = e.closest(".card-block-wrap"); return e ? (e._advTabControllers || []).map(e => e._advController).filter(Boolean) : [] } function n(a) { if (a) { var t = a.closest(".date-range-dd-select"); if (t) { var n = a.dataset.dropdown, o = t.querySelector(".date-range-dd-selected"), a = a.querySelector(".dropdown-item-text"), o = (o && a && (o.textContent = a.textContent.trim()), i(t)), a = ((a = (a = (a = t).closest(".card-block-wrap")) && a._advDateBounds)?.min && a?.max ? (new Date(a.min), new Date(a.max)) : (a = new Date, new Date(a.getFullYear(), a.getMonth(), 1)), t.closest(".card-block-wrap")), t = a && a.classList.contains("card-adv") && (a.classList.contains("section-formats") || a.classList.contains("section-offers") || a.classList.contains("section-usecases")); let e, r; if ("lastWeek" === n) r = new Date, (e = new Date(r)).setDate(e.getDate() - 6); else if ("lastMonth" === n) r = new Date, (e = new Date(r)).setDate(e.getDate() - 29); else { if ("lastYear" !== n) return; r = new Date, (e = new Date(r)).setDate(e.getDate() - 364) } if (t) c(a, [e, r]); else if (o.length) { let a = advToISODate(e), t = advToISODate(r); o.forEach(e => e.setDateRange(a, t)) } } } } function o(r, e, n) { n = n.input.closest(".date-range-dd-select"); if (n) { var o = n.querySelector(".date-range-dd-selected"), s = i(n); if (o && r && r.length) { var l = { day: "2-digit", month: "short", year: "numeric" }; if (1 === r.length) { let e = r[0].toLocaleDateString(void 0, l); void (o.textContent = e + " …") } else { var d = r[0], r = r[1]; let e = d.toLocaleDateString(void 0, l); l = r.toLocaleDateString(void 0, l); o.textContent = e + " – " + l; let a = advToISODate(d), t = advToISODate(r); o = n.closest(".card-block-wrap"); o && o.classList.contains("card-adv") && (o.classList.contains("section-formats") || o.classList.contains("section-offers") || o.classList.contains("section-usecases")) ? c(o, [d, r]) : s.length && s.forEach(e => e.setDateRange(a, t)) } } } } function s(e, a, t) { var r = t.input.closest(".date-range-dd-select"); if (r) { var n = r.querySelector(".date-range-dd-selected"), o = i(r); if (n) if (t.config && "range" === t.config.mode && e && 1 === e.length) { var s = e[0], l = (t.setDate([s, s], !1), { day: "2-digit", month: "short", year: "numeric" }), s = s.toLocaleDateString(void 0, l), l = (n.textContent = s + " – " + s, t.selectedDates); if (l && 2 === l.length) { n = l[0], s = l[1], t = r.closest(".card-block-wrap"); if (t && t.classList.contains("card-adv") && (t.classList.contains("section-formats") || t.classList.contains("section-offers") || t.classList.contains("section-usecases"))) c(t, [n, s]); else if (o.length) { let a = advToISODate(n), t = advToISODate(s); o.forEach(e => e.setDateRange(a, t)) } } } else e && 2 === e.length && (l = r.closest(".card-block-wrap")) && l.classList.contains("card-adv") && (l.classList.contains("section-formats") || l.classList.contains("section-offers") || l.classList.contains("section-usecases")) && c(l, e) } } function c(d, i) { if (d && i && 2 === i.length && d.classList.contains("card-adv")) { var c = advToISODate(i[0]), e = advToISODate(i[1]); if (d._advState || (d._advState = {}), d._advState.compareMode && (d._advState.compareMode = !1, delete d._advState.comparisonData, delete d._advState.mainDateRange, delete d._advState.compareDateRange, d._advTabControllers && d._advTabControllers.forEach(e => { delete e._advComparisonMode, delete e._advMainData, delete e._advCompareData, delete e._advCompareApiUrl; e = e.querySelector(".table-render"); e && e._advTableState && (delete e._advTableState.comparisonMode, delete e._advTableState.mainData, delete e._advTableState.compareData) }), [advFindTabPane(d, "competitors"), advFindTabPane(d, "best-in-class"), advFindTabPane(d, "your-company")].forEach(e => { e && advGetChartWrappers(e).forEach(e => { delete e._advComparisonMode, delete e._advMainData, delete e._advCompareData, delete e._advCompareApiUrl, delete e._advMainRequestedDates, delete e._advCompareRequestedDates, delete e._advMainRequestedDatesArray, delete e._advCompareRequestedDatesArray; e = e.querySelector(".table-render"); e && e._advTableState && (delete e._advTableState.comparisonMode, delete e._advTableState.mainData, delete e._advTableState.compareData) }) })), d._advState.lastProcessedStartDate !== c || d._advState.lastProcessedEndDate !== e || !d._advState.isProcessingDateRange) { d._advState.isProcessingDateRange = !0, d._advState.lastProcessedStartDate = c, d._advState.lastProcessedEndDate = e, d._advState.startDate = c, d._advState.endDate = e; let t = "formats", r = (d.classList.contains("section-offers") ? t = "offers" : d.classList.contains("section-usecases") ? t = "use_cases" : d.classList.contains("section-formats") && (t = "formats"), advFindTabPane(d, "competitors")), n = advFindTabPane(d, "best-in-class"), o = advFindTabPane(d, "your-company"), s = d._advState?.platform || "all", l = d._advState?.adsStatus || "launched"; var u = !d._advState?.lastProcessedStartDate; if (d._advState?.staggeredLoadingInProgress) d._advState.startDate = c, d._advState.endDate = e; else { c = () => { var e = advGetChartWrappers(o); 0 < e.length && advInitChartV2(e[0], advBuildApiUrl(d, { mode: "your_company", chartType: t, service: "windsor", dateRange: i, adsStatus: l })) }; let e = () => { var e = advGetChartWrappers(r); 0 < e.length && advInitChartV2(e[0], advBuildApiUrl(d, { mode: "competitor", chartType: t, service: "creator", dateRange: i, platform: s, adsStatus: l })) }, a = () => { var e = advGetChartWrappers(n); 0 < e.length && advInitChartV2(e[0], advBuildApiUrl(d, { mode: "best_in_class", chartType: t, service: "creator", dateRange: i, platform: s, adsStatus: l })) }; u ? (c(), setTimeout(() => { e() }, 3e3), setTimeout(() => { a() }, 5e3)) : (c(), e(), a()), setTimeout(() => { d._advState && (d._advState.isProcessingDateRange = !1) }, 500) } } } } window.updateAnglesChartsWithComparison = function (a, t, r) { if (a && t && 2 === t.length && r && 2 === r.length && a.classList.contains("card-adv")) { advToISODate(t[0]), advToISODate(t[1]), advToISODate(r[0]), advToISODate(r[1]); a._advState || (a._advState = {}), a._advState.comparisonData || (a._advState.comparisonData = {}); let e = "formats"; a.classList.contains("section-offers") ? e = "offers" : a.classList.contains("section-usecases") ? e = "use_cases" : a.classList.contains("section-formats") && (e = "formats"); var n = a._advState?.platform || "all", o = a._advState?.adsStatus || "launched", s = advFindTabPane(a, "your-company"); s ? 0 < (s = advGetChartWrappers(s)).length ? advInitChartV2Comparison(s[0], advBuildApiUrl(a, { mode: "your_company", chartType: e, service: "windsor", dateRange: t, platform: n, adsStatus: o }), advBuildApiUrl(a, { mode: "your_company", chartType: e, service: "windsor", dateRange: r, platform: n, adsStatus: o })) : console.warn("[ADV] No chart wrappers found in Your Company tab") : console.error("[ADV] Your Company tab not found") } }, document.addEventListener("DOMContentLoaded", function () { document.querySelectorAll(".date-range-dd-select").forEach(t => { if (!t.classList.contains("date-custom")) { let e = t.querySelector('[data-default="1"]') || t.querySelector("[data-dropdown]"); var a = t.querySelector(".date-range-dd-selected"), r = (e && a && ((r = e.querySelector(".dropdown-item-text")) && (a.textContent = r.textContent.trim()), !(a = t.closest(".card-block-wrap")) || a._advState && a._advState.startDate && a._advState.endDate || setTimeout(() => { n(e) }, 100)), t.querySelector(".custom-range") || t.querySelector(".date-range-input")), a = (r && "function" == typeof flatpickr && flatpickr(r, { mode: "range", dateFormat: "Y-m-d", allowInput: !0, altInput: !0, altFormat: "d M Y", onChange: o, onClose: s, onOpen: function () { var e, a = t.closest(".card-block-wrap"); a && (a = a.querySelector(".platform-dd-select")) && (e = a.querySelector(".filter-dropdown-toggle, .w-dropdown-toggle")) && (a = a.querySelector(".w-dropdown, .dropdown")) && window.$ && $(a).hasClass("w-open") && e.click() } }), t.querySelector(".filter-dropdown-toggle, .w-dropdown-toggle")); a && a.addEventListener("click", function () { var e, a = t.closest(".card-block-wrap"); a && (a = a.querySelector(".platform-dd-select")) && (e = a.querySelector(".filter-dropdown-toggle, .w-dropdown-toggle")) && (a = a.querySelector(".w-dropdown, .dropdown")) && window.$ && $(a).hasClass("w-open") && e.click() }) } }) }), document.addEventListener("click", e => { var a, e = e.target.closest(".date-range-dd-select [data-dropdown]"); e && "INPUT" !== e.tagName && "TEXTAREA" !== e.tagName && (n(e), (a = e.closest(".dropdown,.w-dropdown")) && window.$ && $(a).triggerHandler("w-close.w-dropdown"), a = e.closest(".card-block-wrap")) && (e = a.querySelector(".platform-dd-select")) && (a = e.querySelector(".filter-dropdown-toggle, .w-dropdown-toggle")) && (e = e.querySelector(".w-dropdown, .dropdown")) && window.$ && $(e).hasClass("w-open") && a.click() }) }(), document.addEventListener("DOMContentLoaded", function () { document.querySelectorAll(".card-block-wrap").forEach(o => { if (o.classList.contains("card-adv")) { var e, a, t; o._advState || (o._advState = { startDate: null, endDate: null, metric: null, company: null, channels: null }), [advFindTabPane(o, "competitors"), advFindTabPane(o, "best-in-class")].forEach(e => { var a; e && (e = e.querySelector(".chart-metric-dd-select")) && ((a = e.querySelector(".chart-metric-dd-selected")) && (a.textContent = "Ads Launched"), e.classList.add("my-hidden"), e.style.display = "none") }); let n = o.querySelector(".platform-dd-select"); n && ((a = n.querySelector(".filter-dropdown-toggle, .w-dropdown-toggle")) && a.addEventListener("click", function () { o.querySelectorAll(".date-range-dd-select .w-dropdown, .date-range-dd-select .dropdown").forEach(e => { window.$ && $(e).hasClass("w-open") && $(e).triggerHandler("w-close.w-dropdown") }) }), a = n.querySelector('[data-dropdown="all"]'), t = n.querySelector('[data-dropdown="default"]'), e = a || t, advApplyPlatformToBlock(o, !a && t ? "facebook" : "all", !0), e && (a = n.querySelector(".platform-dd-selected")) && ("all" === e.getAttribute("data-dropdown") ? a.textContent = "Platform" : (t = e.querySelector(".dropdown-item-text")) && (a.textContent = t.textContent.trim())), n.addEventListener("click", function (e) { var a, t, r, e = e.target.closest("[data-dropdown]"); e && (a = "default" === (t = e.getAttribute("data-dropdown")) ? "facebook" : t, (r = (o._advTabControllers || []).map(e => e._advController).filter(Boolean)).length && (r = r[0], o._advState.startDate = r._advStartDate || null, o._advState.endDate = r._advEndDate || null, o._advState.metric = r._advMetric || null, o._advState.company = r._advCompany || null, o._advState.channels = r._advChannels || null), (r = n.querySelector(".platform-dd-selected")) && ("all" === t ? r.textContent = "Platform" : (t = e.querySelector(".dropdown-item-text")) && (r.textContent = t.textContent.trim())), advApplyPlatformToBlock(o, a), setTimeout(() => { let s = o._advState; (o._advTabControllers || []).map(e => e._advController).filter(Boolean).forEach(a => { if (a) if (s.company && a.setCompany(s.company), s.channels?.length && a.setChannels(s.channels), s.startDate && s.endDate && a.setDateRange(s.startDate, s.endDate), s.metric && a._advJsonData) { var t = a._advJsonData, r = t.baseMetrics || []; if (r.includes(s.metric)) { var e = t.dates || [], n = a._advStartDate && a._advEndDate ? advFilterDateRange(e, a._advStartDate, a._advEndDate) : e.map((e, a) => a); if (advIsChartPayloadEmpty(advBuildChartPayload({ json: t, channelIds: a._advChannels || [], dateIndexes: n, metric: s.metric, mode: 0 === a._advChannels?.length ? "consolidate" : "direct", valueType: "absolute" }))) { let e = null; for (var o of r) if (!advIsChartPayloadEmpty(advBuildChartPayload({ json: t, channelIds: a._advChannels || [], dateIndexes: n, metric: o, mode: 0 === a._advChannels?.length ? "consolidate" : "direct", valueType: "absolute" }))) { e = o; break } e && a.setMetric(e) } else a.setMetric(s.metric) } } else s.metric && a.setMetric(s.metric) }) }, 80), r = e.closest(".dropdown,.w-dropdown")) && window.$ && $(r).triggerHandler("w-close.w-dropdown") })) } }) }), document.addEventListener("DOMContentLoaded", function () { document.querySelectorAll(".filter-context-card").forEach(l => { let d = l.closest(".card-block-wrap"), i = d && d.classList.contains("card-adv") && (d.classList.contains("section-formats") || d.classList.contains("section-offers") || d.classList.contains("section-usecases")), c = "formats"; d && (d.classList.contains("section-offers") ? c = "offers" : d.classList.contains("section-usecases") ? c = "use_cases" : d.classList.contains("section-formats") && (c = "formats")); var e = l.querySelector(".date-range-input-main"), a = l.querySelector(".date-range-input-compare"), t = l.querySelector(".apply-compare-btn"), r = l.querySelector(".cancel-compare-btn"); let u = l.querySelector(".compare-range-filter"), n = l.querySelector(".main-start-display"), p = l.querySelector(".main-end-display"), v = l.querySelector(".compare-start-display"), m = l.querySelector(".compare-end-display"); var h = l.querySelector('[data-dropdown="compareRange"]'); if (e && a && u) { let o, s; o = flatpickr(e, { mode: "range", dateFormat: "Y-m-d", inline: !0, appendTo: l.querySelector(".date-main-section"), showMonths: 1, onChange: function (e, a, t) { updateDisplay(e, n, p), customHighlight(t, e, "highlight-main") } }), s = flatpickr(a, { mode: "range", dateFormat: "Y-m-d", inline: !0, appendTo: l.querySelector(".date-compare-section"), showMonths: 1, onChange: function (e, a, t) { updateDisplay(e, v, m), customHighlight(t, e, "highlight-compare") } }), h && h.addEventListener("click", function () { var e = this.closest(".Filter-Dropdown-List"); e && (e.style.display = "none"), u && (u.style.display = "block"), o && o.open(), s && s.open() }), t && t.addEventListener("click", function () { var e = o.selectedDates, a = s.selectedDates; if (2 === e.length && 2 === a.length) { var t = correctionCompareRange(e[0], e[1], a[0]), r = [a[0], t]; if (s.setDate([a[0], t], !1), updateDisplay([a[0], t], v, m), customHighlight(s, [a[0], t], "highlight-compare"), console.log("======================================="), console.log("APPLY CLICKED: Filter Data Check"), console.log("Card Context:", l), console.log("Parent Card:", d), console.log("Section Type:", c), console.log("Is Angles/Offers/UseCase Card:", i), console.log("---------------------------------------"), console.log("Main Range Start:", e[0].toLocaleDateString("en-US")), console.log("Main Range End:", e[1].toLocaleDateString("en-US")), console.log("Compare Range Start:", a[0].toLocaleDateString("en-US")), console.log("Compare Range End (Original):", a[1].toLocaleDateString("en-US")), console.log("Compare Range End (Normalized):", t.toLocaleDateString("en-US")), console.log("======================================="), i && d) { var t = d.querySelector(".w-tab-pane.w--tab-active") || d.querySelector('.w-tab-pane[style*="display"][style*="block"]'), t = t && ("your-company" === t.getAttribute("data-w-tab") || t.classList.contains("your-company-tab")), n = d.querySelectorAll(".w-tab-link"); let a = null; n.forEach(e => { e.classList.contains("w--current") && (a = e.getAttribute("data-w-tab")) }); n = "your-company" === a; if (!t && !n) return console.warn('[ADV] Compare range only works on "Your Company" tab. Current tab:', a), alert('Compare range feature is only available in the "Your Company" tab. Please switch to the "Your Company" tab first.'), void (u && (u.style.display = "none")); d._advState || (d._advState = {}), d._advState.compareMode = !0, d._advState.mainDateRange = e, d._advState.compareDateRange = r, "function" == typeof window.updateAnglesChartsWithComparison ? window.updateAnglesChartsWithComparison(d, e, r) : console.error("updateAnglesChartsWithComparison function not found") } } else console.warn("APPLY CLICKED: Date selection incomplete. Main dates selected:", e.length, "Compare dates selected:", a.length); u && (u.style.display = "none") }), r && r.addEventListener("click", function () { u && (u.style.display = "none") }) } else console.error("CRITICAL ERROR: Core elements not found in card.", l) }) });